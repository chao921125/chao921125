import{R as Ce,Q as Oe,E as Lt,af as bi,d as at,a as J,X as $e,aj as Ui,c as ft,ak as V,al as qe,am as et,an as _t,ao as Dt,ap as Ft,aq as At,ar as S,f as Vi,L as Hi,P as zi,as as Ji,at as Ki,au as Qt,av as Qe,aw as ti,ax as ji,ay as te,az as Mt,aA as kt,aB as ee,aC as Zi,aD as Re,aE as $i,B as K,aF as ct,aG as Gt,aH as ie,aI as ei,aJ as qi,j as X,aK as Qi,aL as pt,aM as ne,aN as tn,aO as en,aP as nn,k as re,p as vt,Y as we,aQ as rn,aR as Pt,aS as an,aT as ii,g as ae,F as sn,n as Le,aU as se,aV as on,l as hn,aW as ln,b as un,aX as ni,S as ri,aY as oe,u as he,aZ as fn,m as cn,t as dn,h as _n,ae as Nt,r as pn,a_ as vn,a$ as gn,C as yn,b0 as mn,q as ai,b1 as si,a7 as xn,ag as In,b2 as Sn,b3 as Tn,b4 as oi,b5 as En,b6 as Cn,a6 as On,b7 as Rn}from"./ol.bb58850a.js";var wn=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ln=function(a){wn(i,a);function i(t){var e=a.call(this)||this;if(e.on,e.once,e.un,e.id_=void 0,e.geometryName_="geometry",e.style_=null,e.styleFunction_=void 0,e.geometryChangeKey_=null,e.addChangeListener(e.geometryName_,e.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){var n=t;e.setGeometry(n)}else{var r=t;e.setProperties(r)}return e}return i.prototype.clone=function(){var t=new i(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var e=this.getGeometry();e&&t.setGeometry(e.clone());var n=this.getStyle();return n&&t.setStyle(n),t},i.prototype.getGeometry=function(){return this.get(this.geometryName_)},i.prototype.getId=function(){return this.id_},i.prototype.getGeometryName=function(){return this.geometryName_},i.prototype.getStyle=function(){return this.style_},i.prototype.getStyleFunction=function(){return this.styleFunction_},i.prototype.handleGeometryChange_=function(){this.changed()},i.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(Ce(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=Oe(t,Lt.CHANGE,this.handleGeometryChange_,this)),this.changed()},i.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},i.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?Dn(t):void 0,this.changed()},i.prototype.setId=function(t){this.id_=t,this.changed()},i.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},i}(bi);function Dn(a){if(typeof a=="function")return a;var i;if(Array.isArray(a))i=a;else{at(typeof a.getZIndex=="function",41);var t=a;i=[t]}return function(){return i}}var ia=Ln,Fn=function(){function a(i){var t=i||{};this.color_=t.color!==void 0?t.color:null}return a.prototype.clone=function(){var i=this.getColor();return new a({color:Array.isArray(i)?i.slice():i||void 0})},a.prototype.getColor=function(){return this.color_},a.prototype.setColor=function(i){this.color_=i},a}(),De=Fn;function An(a,i,t,e){for(var n=a[i],r=a[i+1],s=0,o=i+e;o<t;o+=e){var h=a[o],l=a[o+1];s+=Math.sqrt((h-n)*(h-n)+(l-r)*(l-r)),n=h,r=l}return s}var Mn=function(){function a(i){var t=i||{};this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}return a.prototype.clone=function(){var i=this.getColor();return new a({color:Array.isArray(i)?i.slice():i||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},a.prototype.getColor=function(){return this.color_},a.prototype.getLineCap=function(){return this.lineCap_},a.prototype.getLineDash=function(){return this.lineDash_},a.prototype.getLineDashOffset=function(){return this.lineDashOffset_},a.prototype.getLineJoin=function(){return this.lineJoin_},a.prototype.getMiterLimit=function(){return this.miterLimit_},a.prototype.getWidth=function(){return this.width_},a.prototype.setColor=function(i){this.color_=i},a.prototype.setLineCap=function(i){this.lineCap_=i},a.prototype.setLineDash=function(i){this.lineDash_=i},a.prototype.setLineDashOffset=function(i){this.lineDashOffset_=i},a.prototype.setLineJoin=function(i){this.lineJoin_=i},a.prototype.setMiterLimit=function(i){this.miterLimit_=i},a.prototype.setWidth=function(i){this.width_=i},a}(),le=Mn,kn=function(){function a(i){this.opacity_=i.opacity,this.rotateWithView_=i.rotateWithView,this.rotation_=i.rotation,this.scale_=i.scale,this.scaleArray_=$e(i.scale),this.displacement_=i.displacement}return a.prototype.clone=function(){var i=this.getScale();return new a({opacity:this.getOpacity(),scale:Array.isArray(i)?i.slice():i,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},a.prototype.getOpacity=function(){return this.opacity_},a.prototype.getRotateWithView=function(){return this.rotateWithView_},a.prototype.getRotation=function(){return this.rotation_},a.prototype.getScale=function(){return this.scale_},a.prototype.getScaleArray=function(){return this.scaleArray_},a.prototype.getDisplacement=function(){return this.displacement_},a.prototype.getAnchor=function(){return J()},a.prototype.getImage=function(i){return J()},a.prototype.getHitDetectionImage=function(){return J()},a.prototype.getPixelRatio=function(i){return 1},a.prototype.getImageState=function(){return J()},a.prototype.getImageSize=function(){return J()},a.prototype.getOrigin=function(){return J()},a.prototype.getSize=function(){return J()},a.prototype.setOpacity=function(i){this.opacity_=i},a.prototype.setRotateWithView=function(i){this.rotateWithView_=i},a.prototype.setRotation=function(i){this.rotation_=i},a.prototype.setScale=function(i){this.scale_=i,this.scaleArray_=$e(i)},a.prototype.listenImageChange=function(i){J()},a.prototype.load=function(){J()},a.prototype.unlistenImageChange=function(i){J()},a}(),hi=kn;function j(a){return Array.isArray(a)?Ui(a):a}var Gn=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Pn=function(a){Gn(i,a);function i(t){var e=this,n=t.rotateWithView!==void 0?t.rotateWithView:!1;return e=a.call(this,{opacity:1,rotateWithView:n,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0]})||this,e.canvas_=void 0,e.hitDetectionCanvas_=null,e.fill_=t.fill!==void 0?t.fill:null,e.origin_=[0,0],e.points_=t.points,e.radius_=t.radius!==void 0?t.radius:t.radius1,e.radius2_=t.radius2,e.angle_=t.angle!==void 0?t.angle:0,e.stroke_=t.stroke!==void 0?t.stroke:null,e.anchor_=null,e.size_=null,e.renderOptions_=null,e.render(),e}return i.prototype.clone=function(){var t=this.getScale(),e=new i({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e},i.prototype.getAnchor=function(){return this.anchor_},i.prototype.getAngle=function(){return this.angle_},i.prototype.getFill=function(){return this.fill_},i.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},i.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var n=this.renderOptions_,r=ft(n.size*t,n.size*t);this.draw_(n,r,t),e=r.canvas,this.canvas_[t]=e}return e},i.prototype.getPixelRatio=function(t){return t},i.prototype.getImageSize=function(){return this.size_},i.prototype.getImageState=function(){return V.LOADED},i.prototype.getOrigin=function(){return this.origin_},i.prototype.getPoints=function(){return this.points_},i.prototype.getRadius=function(){return this.radius_},i.prototype.getRadius2=function(){return this.radius2_},i.prototype.getSize=function(){return this.size_},i.prototype.getStroke=function(){return this.stroke_},i.prototype.listenImageChange=function(t){},i.prototype.load=function(){},i.prototype.unlistenImageChange=function(t){},i.prototype.calculateLineJoinSize_=function(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;var r=this.radius_,s=this.radius2_===void 0?r:this.radius2_;if(r<s){var o=r;r=s,s=o}var h=this.radius2_===void 0?this.points_:this.points_*2,l=2*Math.PI/h,u=s*Math.sin(l),f=Math.sqrt(s*s-u*u),c=r-f,d=Math.sqrt(u*u+c*c),_=d/u;if(t==="miter"&&_<=n)return _*e;var p=e/2/_,v=e/2*(c/d),g=Math.sqrt((r+p)*(r+p)+v*v),m=g-r;if(this.radius2_===void 0||t==="bevel")return m*2;var x=r*Math.sin(l),I=Math.sqrt(r*r-x*x),T=s-I,O=Math.sqrt(x*x+T*T),w=O/x;if(w<=n){var C=w*e/2-s-r;return 2*Math.max(m,C)}return m*2},i.prototype.createRenderOptions=function(){var t=_t,e=0,n=null,r=0,s,o=0;this.stroke_&&(s=this.stroke_.getColor(),s===null&&(s=Dt),s=j(s),o=this.stroke_.getWidth(),o===void 0&&(o=Ft),n=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=_t),e=this.stroke_.getMiterLimit(),e===void 0&&(e=At));var h=this.calculateLineJoinSize_(t,o,e),l=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*l+h);return{strokeStyle:s,strokeWidth:o,size:u,lineDash:n,lineDashOffset:r,lineJoin:t,miterLimit:e}},i.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size,e=this.getDisplacement();this.canvas_={},this.anchor_=[t/2-e[0],t/2+e[1]],this.size_=[t,t]},i.prototype.draw_=function(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var r=this.fill_.getColor();r===null&&(r=et),e.fillStyle=j(r),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},i.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),n=0;if(typeof e=="string"&&(e=qe(e)),e===null?n=1:Array.isArray(e)&&(n=e.length===4?e[3]:1),n===0){var r=ft(t.size,t.size);this.hitDetectionCanvas_=r.canvas,this.drawHitDetectionCanvas_(t,r)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},i.prototype.createPath_=function(t){var e=this.points_,n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{var r=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);for(var s=this.angle_-Math.PI/2,o=2*Math.PI/e,h=0;h<e;h++){var l=s+h*o,u=h%2==0?n:r;t.lineTo(u*Math.cos(l),u*Math.sin(l))}t.closePath()}},i.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=et,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},i}(hi),Nn=Pn,Bn=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Yn=function(a){Bn(i,a);function i(t){var e=this,n=t||{};return e=a.call(this,{points:1/0,fill:n.fill,radius:n.radius,stroke:n.stroke,scale:n.scale!==void 0?n.scale:1,rotation:n.rotation!==void 0?n.rotation:0,rotateWithView:n.rotateWithView!==void 0?n.rotateWithView:!1,displacement:n.displacement!==void 0?n.displacement:[0,0]})||this,e}return i.prototype.clone=function(){var t=this.getScale(),e=new i({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e},i.prototype.setRadius=function(t){this.radius_=t,this.render()},i}(Nn),li=Yn,gt=function(){function a(i){var t=i||{};this.geometry_=null,this.geometryFunction_=ui,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}return a.prototype.clone=function(){var i=this.getGeometry();return i&&typeof i=="object"&&(i=i.clone()),new a({geometry:i,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},a.prototype.getRenderer=function(){return this.renderer_},a.prototype.setRenderer=function(i){this.renderer_=i},a.prototype.setHitDetectionRenderer=function(i){this.hitDetectionRenderer_=i},a.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},a.prototype.getGeometry=function(){return this.geometry_},a.prototype.getGeometryFunction=function(){return this.geometryFunction_},a.prototype.getFill=function(){return this.fill_},a.prototype.setFill=function(i){this.fill_=i},a.prototype.getImage=function(){return this.image_},a.prototype.setImage=function(i){this.image_=i},a.prototype.getStroke=function(){return this.stroke_},a.prototype.setStroke=function(i){this.stroke_=i},a.prototype.getText=function(){return this.text_},a.prototype.setText=function(i){this.text_=i},a.prototype.getZIndex=function(){return this.zIndex_},a.prototype.setGeometry=function(i){typeof i=="function"?this.geometryFunction_=i:typeof i=="string"?this.geometryFunction_=function(t){return t.get(i)}:i?i!==void 0&&(this.geometryFunction_=function(){return i}):this.geometryFunction_=ui,this.geometry_=i},a.prototype.setZIndex=function(i){this.zIndex_=i},a}();function Wn(a){var i;if(typeof a=="function")i=a;else{var t;if(Array.isArray(a))t=a;else{at(typeof a.getZIndex=="function",41);var e=a;t=[e]}i=function(){return t}}return i}var Fe=null;function Xn(a,i){if(!Fe){var t=new De({color:"rgba(255,255,255,0.4)"}),e=new le({color:"#3399CC",width:1.25});Fe=[new gt({image:new li({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return Fe}function na(){var a={},i=[255,255,255,1],t=[0,153,255,1],e=3;return a[S.POLYGON]=[new gt({fill:new De({color:[255,255,255,.5]})})],a[S.MULTI_POLYGON]=a[S.POLYGON],a[S.LINE_STRING]=[new gt({stroke:new le({color:i,width:e+2})}),new gt({stroke:new le({color:t,width:e})})],a[S.MULTI_LINE_STRING]=a[S.LINE_STRING],a[S.CIRCLE]=a[S.POLYGON].concat(a[S.LINE_STRING]),a[S.POINT]=[new gt({image:new li({radius:e*2,fill:new De({color:t}),stroke:new le({color:i,width:e/2})}),zIndex:1/0})],a[S.MULTI_POINT]=a[S.POINT],a[S.GEOMETRY_COLLECTION]=a[S.POLYGON].concat(a[S.LINE_STRING],a[S.POINT]),a}function ui(a){return a.getGeometry()}var ra=gt,bn={POINT:"point",LINE:"line"};function Un(a,i,t,e,n){fi(a,i,t||0,e||a.length-1,n||Vn)}function fi(a,i,t,e,n){for(;e>t;){if(e-t>600){var r=e-t+1,s=i-t+1,o=Math.log(r),h=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*h*(r-h)/r)*(s-r/2<0?-1:1),u=Math.max(t,Math.floor(i-s*h/r+l)),f=Math.min(e,Math.floor(i+(r-s)*h/r+l));fi(a,i,u,f,n)}var c=a[i],d=t,_=e;for(Bt(a,t,i),n(a[e],c)>0&&Bt(a,t,e);d<_;){for(Bt(a,d,_),d++,_--;n(a[d],c)<0;)d++;for(;n(a[_],c)>0;)_--}n(a[t],c)===0?Bt(a,t,_):(_++,Bt(a,_,e)),_<=i&&(t=_+1),i<=_&&(e=_-1)}}function Bt(a,i,t){var e=a[i];a[i]=a[t],a[t]=e}function Vn(a,i){return a<i?-1:a>i?1:0}class ci{constructor(i=9){this._maxEntries=Math.max(4,i),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(i){let t=this.data;const e=[];if(!fe(i,t))return e;const n=this.toBBox,r=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],h=t.leaf?n(o):o;fe(i,h)&&(t.leaf?e.push(o):Me(i,h)?this._all(o,e):r.push(o))}t=r.pop()}return e}collides(i){let t=this.data;if(!fe(i,t))return!1;const e=[];for(;t;){for(let n=0;n<t.children.length;n++){const r=t.children[n],s=t.leaf?this.toBBox(r):r;if(fe(i,s)){if(t.leaf||Me(i,s))return!0;e.push(r)}}t=e.pop()}return!1}load(i){if(!(i&&i.length))return this;if(i.length<this._minEntries){for(let e=0;e<i.length;e++)this.insert(i[e]);return this}let t=this._build(i.slice(),0,i.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(i){return i&&this._insert(i,this.data.height-1),this}clear(){return this.data=mt([]),this}remove(i,t){if(!i)return this;let e=this.data;const n=this.toBBox(i),r=[],s=[];let o,h,l;for(;e||r.length;){if(e||(e=r.pop(),h=r[r.length-1],o=s.pop(),l=!0),e.leaf){const u=Hn(i,e.children,t);if(u!==-1)return e.children.splice(u,1),r.push(e),this._condense(r),this}!l&&!e.leaf&&Me(e,n)?(r.push(e),s.push(o),o=0,h=e,e=e.children[0]):h?(o++,e=h.children[o],l=!1):e=null}return this}toBBox(i){return i}compareMinX(i,t){return i.minX-t.minX}compareMinY(i,t){return i.minY-t.minY}toJSON(){return this.data}fromJSON(i){return this.data=i,this}_all(i,t){const e=[];for(;i;)i.leaf?t.push(...i.children):e.push(...i.children),i=e.pop();return t}_build(i,t,e,n){const r=e-t+1;let s=this._maxEntries,o;if(r<=s)return o=mt(i.slice(t,e+1)),yt(o,this.toBBox),o;n||(n=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/Math.pow(s,n-1))),o=mt([]),o.leaf=!1,o.height=n;const h=Math.ceil(r/s),l=h*Math.ceil(Math.sqrt(s));di(i,t,e,l,this.compareMinX);for(let u=t;u<=e;u+=l){const f=Math.min(u+l-1,e);di(i,u,f,h,this.compareMinY);for(let c=u;c<=f;c+=h){const d=Math.min(c+h-1,f);o.children.push(this._build(i,c,d,n-1))}}return yt(o,this.toBBox),o}_chooseSubtree(i,t,e,n){for(;n.push(t),!(t.leaf||n.length-1===e);){let r=1/0,s=1/0,o;for(let h=0;h<t.children.length;h++){const l=t.children[h],u=Ae(l),f=Kn(i,l)-u;f<s?(s=f,r=u<r?u:r,o=l):f===s&&u<r&&(r=u,o=l)}t=o||t.children[0]}return t}_insert(i,t,e){const n=e?i:this.toBBox(i),r=[],s=this._chooseSubtree(n,this.data,t,r);for(s.children.push(i),Wt(s,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)}_split(i,t){const e=i[t],n=e.children.length,r=this._minEntries;this._chooseSplitAxis(e,r,n);const s=this._chooseSplitIndex(e,r,n),o=mt(e.children.splice(s,e.children.length-s));o.height=e.height,o.leaf=e.leaf,yt(e,this.toBBox),yt(o,this.toBBox),t?i[t-1].children.push(o):this._splitRoot(e,o)}_splitRoot(i,t){this.data=mt([i,t]),this.data.height=i.height+1,this.data.leaf=!1,yt(this.data,this.toBBox)}_chooseSplitIndex(i,t,e){let n,r=1/0,s=1/0;for(let o=t;o<=e-t;o++){const h=Yt(i,0,o,this.toBBox),l=Yt(i,o,e,this.toBBox),u=jn(h,l),f=Ae(h)+Ae(l);u<r?(r=u,n=o,s=f<s?f:s):u===r&&f<s&&(s=f,n=o)}return n||e-t}_chooseSplitAxis(i,t,e){const n=i.leaf?this.compareMinX:zn,r=i.leaf?this.compareMinY:Jn,s=this._allDistMargin(i,t,e,n),o=this._allDistMargin(i,t,e,r);s<o&&i.children.sort(n)}_allDistMargin(i,t,e,n){i.children.sort(n);const r=this.toBBox,s=Yt(i,0,t,r),o=Yt(i,e-t,e,r);let h=ue(s)+ue(o);for(let l=t;l<e-t;l++){const u=i.children[l];Wt(s,i.leaf?r(u):u),h+=ue(s)}for(let l=e-t-1;l>=t;l--){const u=i.children[l];Wt(o,i.leaf?r(u):u),h+=ue(o)}return h}_adjustParentBBoxes(i,t,e){for(let n=e;n>=0;n--)Wt(t[n],i)}_condense(i){for(let t=i.length-1,e;t>=0;t--)i[t].children.length===0?t>0?(e=i[t-1].children,e.splice(e.indexOf(i[t]),1)):this.clear():yt(i[t],this.toBBox)}}function Hn(a,i,t){if(!t)return i.indexOf(a);for(let e=0;e<i.length;e++)if(t(a,i[e]))return e;return-1}function yt(a,i){Yt(a,0,a.children.length,i,a)}function Yt(a,i,t,e,n){n||(n=mt(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=i;r<t;r++){const s=a.children[r];Wt(n,a.leaf?e(s):s)}return n}function Wt(a,i){return a.minX=Math.min(a.minX,i.minX),a.minY=Math.min(a.minY,i.minY),a.maxX=Math.max(a.maxX,i.maxX),a.maxY=Math.max(a.maxY,i.maxY),a}function zn(a,i){return a.minX-i.minX}function Jn(a,i){return a.minY-i.minY}function Ae(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function ue(a){return a.maxX-a.minX+(a.maxY-a.minY)}function Kn(a,i){return(Math.max(i.maxX,a.maxX)-Math.min(i.minX,a.minX))*(Math.max(i.maxY,a.maxY)-Math.min(i.minY,a.minY))}function jn(a,i){const t=Math.max(a.minX,i.minX),e=Math.max(a.minY,i.minY),n=Math.min(a.maxX,i.maxX),r=Math.min(a.maxY,i.maxY);return Math.max(0,n-t)*Math.max(0,r-e)}function Me(a,i){return a.minX<=i.minX&&a.minY<=i.minY&&i.maxX<=a.maxX&&i.maxY<=a.maxY}function fe(a,i){return i.minX<=a.maxX&&i.minY<=a.maxY&&i.maxX>=a.minX&&i.maxY>=a.minY}function mt(a){return{children:a,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function di(a,i,t,e,n){const r=[i,t];for(;r.length;){if(t=r.pop(),i=r.pop(),t-i<=e)continue;const s=i+Math.ceil((t-i)/e/2)*e;Un(a,s,i,t,n),r.push(i,s,s,t)}}var Zn=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),_i={RENDER_ORDER:"renderOrder"},$n=function(a){Zn(i,a);function i(t){var e=this,n=t||{},r=Vi({},n);return delete r.style,delete r.renderBuffer,delete r.updateWhileAnimating,delete r.updateWhileInteracting,e=a.call(this,r)||this,e.declutter_=n.declutter!==void 0?n.declutter:!1,e.renderBuffer_=n.renderBuffer!==void 0?n.renderBuffer:100,e.style_=null,e.styleFunction_=void 0,e.setStyle(n.style),e.updateWhileAnimating_=n.updateWhileAnimating!==void 0?n.updateWhileAnimating:!1,e.updateWhileInteracting_=n.updateWhileInteracting!==void 0?n.updateWhileInteracting:!1,e}return i.prototype.getDeclutter=function(){return this.declutter_},i.prototype.getFeatures=function(t){return a.prototype.getFeatures.call(this,t)},i.prototype.getRenderBuffer=function(){return this.renderBuffer_},i.prototype.getRenderOrder=function(){return this.get(_i.RENDER_ORDER)},i.prototype.getStyle=function(){return this.style_},i.prototype.getStyleFunction=function(){return this.styleFunction_},i.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},i.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},i.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new ci(9)),this.getRenderer().renderDeclutter(t)},i.prototype.setRenderOrder=function(t){this.set(_i.RENDER_ORDER,t)},i.prototype.setStyle=function(t){this.style_=t!==void 0?t:Xn,this.styleFunction_=t===null?void 0:Wn(this.style_),this.changed()},i}(Hi),qn=$n,Xt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ce=[Xt.FILL],st=[Xt.STROKE],dt=[Xt.BEGIN_PATH],pi=[Xt.CLOSE_PATH],E=Xt,Qn=function(){function a(){}return a.prototype.drawCustom=function(i,t,e,n){},a.prototype.drawGeometry=function(i){},a.prototype.setStyle=function(i){},a.prototype.drawCircle=function(i,t){},a.prototype.drawFeature=function(i,t){},a.prototype.drawGeometryCollection=function(i,t){},a.prototype.drawLineString=function(i,t){},a.prototype.drawMultiLineString=function(i,t){},a.prototype.drawMultiPoint=function(i,t){},a.prototype.drawMultiPolygon=function(i,t){},a.prototype.drawPoint=function(i,t){},a.prototype.drawPolygon=function(i,t){},a.prototype.drawText=function(i,t){},a.prototype.setFillStrokeStyle=function(i,t){},a.prototype.setImageStyle=function(i,t){},a.prototype.setTextStyle=function(i,t){},a}(),vi=Qn,tr=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),er=function(a){tr(i,a);function i(t,e,n,r){var s=a.call(this)||this;return s.tolerance=t,s.maxExtent=e,s.pixelRatio=r,s.maxLineWidth=0,s.resolution=n,s.beginGeometryInstruction1_=null,s.beginGeometryInstruction2_=null,s.bufferedMaxExtent_=null,s.instructions=[],s.coordinates=[],s.tmpCoordinate_=[],s.hitDetectionInstructions=[],s.state={},s}return i.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})},i.prototype.appendFlatPointCoordinates=function(t,e){for(var n=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,s=this.coordinates,o=s.length,h=0,l=t.length;h<l;h+=e)r[0]=t[h],r[1]=t[h+1],zi(n,r)&&(s[o++]=r[0],s[o++]=r[1]);return o},i.prototype.appendFlatLineCoordinates=function(t,e,n,r,s,o){var h=this.coordinates,l=h.length,u=this.getBufferedMaxExtent();o&&(e+=r);var f=t[e],c=t[e+1],d=this.tmpCoordinate_,_=!0,p,v,g;for(p=e+r;p<n;p+=r)d[0]=t[p],d[1]=t[p+1],g=Ji(u,d),g!==v?(_&&(h[l++]=f,h[l++]=c,_=!1),h[l++]=d[0],h[l++]=d[1]):g===Ki.INTERSECTING?(h[l++]=d[0],h[l++]=d[1],_=!1):_=!0,f=d[0],c=d[1],v=g;return(s&&_||p===e+r)&&(h[l++]=f,h[l++]=c),l},i.prototype.drawCustomCoordinates_=function(t,e,n,r,s){for(var o=0,h=n.length;o<h;++o){var l=n[o],u=this.appendFlatLineCoordinates(t,e,l,r,!1,!1);s.push(u),e=l}return e},i.prototype.drawCustom=function(t,e,n,r){this.beginGeometry(t,e);var s=t.getType(),o=t.getStride(),h=this.coordinates.length,l,u,f,c,d;switch(s){case S.MULTI_POLYGON:l=t.getOrientedFlatCoordinates(),c=[];var _=t.getEndss();d=0;for(var p=0,v=_.length;p<v;++p){var g=[];d=this.drawCustomCoordinates_(l,d,_[p],o,g),c.push(g)}this.instructions.push([E.CUSTOM,h,c,t,n,ti]),this.hitDetectionInstructions.push([E.CUSTOM,h,c,t,r||n,ti]);break;case S.POLYGON:case S.MULTI_LINE_STRING:f=[],l=s==S.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,t.getEnds(),o,f),this.instructions.push([E.CUSTOM,h,f,t,n,Qe]),this.hitDetectionInstructions.push([E.CUSTOM,h,f,t,r||n,Qe]);break;case S.LINE_STRING:case S.CIRCLE:l=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([E.CUSTOM,h,u,t,n,Qt]),this.hitDetectionInstructions.push([E.CUSTOM,h,u,t,r||n,Qt]);break;case S.MULTI_POINT:l=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(l,o),u>h&&(this.instructions.push([E.CUSTOM,h,u,t,n,Qt]),this.hitDetectionInstructions.push([E.CUSTOM,h,u,t,r||n,Qt]));break;case S.POINT:l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),u=this.coordinates.length,this.instructions.push([E.CUSTOM,h,u,t,n]),this.hitDetectionInstructions.push([E.CUSTOM,h,u,t,r||n]);break}this.endGeometry(e)},i.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[E.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[E.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},i.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},i.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var e,n=t.length,r,s,o=-1;for(e=0;e<n;++e)r=t[e],s=r[0],s==E.END_GEOMETRY?o=e:s==E.BEGIN_GEOMETRY&&(r[2]=e,ji(this.hitDetectionInstructions,o,e),o=-1)},i.prototype.setFillStrokeStyle=function(t,e){var n=this.state;if(t){var r=t.getColor();n.fillStyle=j(r||et)}else n.fillStyle=void 0;if(e){var s=e.getColor();n.strokeStyle=j(s||Dt);var o=e.getLineCap();n.lineCap=o!==void 0?o:te;var h=e.getLineDash();n.lineDash=h?h.slice():Mt;var l=e.getLineDashOffset();n.lineDashOffset=l||kt;var u=e.getLineJoin();n.lineJoin=u!==void 0?u:_t;var f=e.getWidth();n.lineWidth=f!==void 0?f:Ft;var c=e.getMiterLimit();n.miterLimit=c!==void 0?c:At,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0},i.prototype.createFill=function(t){var e=t.fillStyle,n=[E.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(!0),n},i.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},i.prototype.createStroke=function(t){return[E.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},i.prototype.updateFillStyle=function(t,e){var n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)},i.prototype.updateStrokeStyle=function(t,e){var n=t.strokeStyle,r=t.lineCap,s=t.lineDash,o=t.lineDashOffset,h=t.lineJoin,l=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=r||s!=t.currentLineDash&&!ee(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=h||t.currentLineWidth!=l||t.currentMiterLimit!=u)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=r,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=h,t.currentLineWidth=l,t.currentMiterLimit=u)},i.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[E.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},i.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Zi(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;Re(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},i}(vi),bt=er,ir=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),nr=function(a){ir(i,a);function i(t,e,n,r){var s=a.call(this,t,e,n,r)||this;return s.hitDetectionImage_=null,s.image_=null,s.imagePixelRatio_=void 0,s.anchorX_=void 0,s.anchorY_=void 0,s.height_=void 0,s.opacity_=void 0,s.originX_=void 0,s.originY_=void 0,s.rotateWithView_=void 0,s.rotation_=void 0,s.scale_=void 0,s.width_=void 0,s.declutterImageWithText_=void 0,s}return i.prototype.drawPoint=function(t,e){if(!!this.image_){this.beginGeometry(t,e);var n=t.getFlatCoordinates(),r=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(n,r);this.instructions.push([E.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([E.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},i.prototype.drawMultiPoint=function(t,e){if(!!this.image_){this.beginGeometry(t,e);var n=t.getFlatCoordinates(),r=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(n,r);this.instructions.push([E.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([E.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},i.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,a.prototype.finish.call(this)},i.prototype.setImageStyle=function(t,e){var n=t.getAnchor(),r=t.getSize(),s=t.getHitDetectionImage(),o=t.getImage(this.pixelRatio),h=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=s,this.image_=o,this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=h[0]*this.imagePixelRatio_,this.originY_=h[1]*this.imagePixelRatio_,this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterImageWithText_=e},i}(bt),rr=nr,ar=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),sr=function(a){ar(i,a);function i(t,e,n,r){return a.call(this,t,e,n,r)||this}return i.prototype.drawFlatCoordinates_=function(t,e,n,r){var s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,n,r,!1,!1),h=[E.MOVE_TO_LINE_TO,s,o];return this.instructions.push(h),this.hitDetectionInstructions.push(h),n},i.prototype.drawLineString=function(t,e){var n=this.state,r=n.strokeStyle,s=n.lineWidth;if(!(r===void 0||s===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Mt,kt],dt);var o=t.getFlatCoordinates(),h=t.getStride();this.drawFlatCoordinates_(o,0,o.length,h),this.hitDetectionInstructions.push(st),this.endGeometry(e)}},i.prototype.drawMultiLineString=function(t,e){var n=this.state,r=n.strokeStyle,s=n.lineWidth;if(!(r===void 0||s===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],dt);for(var o=t.getEnds(),h=t.getFlatCoordinates(),l=t.getStride(),u=0,f=0,c=o.length;f<c;++f)u=this.drawFlatCoordinates_(h,u,o[f],l);this.hitDetectionInstructions.push(st),this.endGeometry(e)}},i.prototype.finish=function(){var t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(st),this.reverseHitDetectionInstructions(),this.state=null,a.prototype.finish.call(this)},i.prototype.applyStroke=function(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(st),t.lastStroke=this.coordinates.length),t.lastStroke=0,a.prototype.applyStroke.call(this,t),this.instructions.push(dt)},i}(bt),or=sr,hr=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),lr=function(a){hr(i,a);function i(t,e,n,r){return a.call(this,t,e,n,r)||this}return i.prototype.drawFlatCoordinatess_=function(t,e,n,r){var s=this.state,o=s.fillStyle!==void 0,h=s.strokeStyle!==void 0,l=n.length;this.instructions.push(dt),this.hitDetectionInstructions.push(dt);for(var u=0;u<l;++u){var f=n[u],c=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,f,r,!0,!h),_=[E.MOVE_TO_LINE_TO,c,d];this.instructions.push(_),this.hitDetectionInstructions.push(_),h&&(this.instructions.push(pi),this.hitDetectionInstructions.push(pi)),e=f}return o&&(this.instructions.push(ce),this.hitDetectionInstructions.push(ce)),h&&(this.instructions.push(st),this.hitDetectionInstructions.push(st)),e},i.prototype.drawCircle=function(t,e){var n=this.state,r=n.fillStyle,s=n.strokeStyle;if(!(r===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_FILL_STYLE,et]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var o=t.getFlatCoordinates(),h=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,h,!1,!1);var u=[E.CIRCLE,l];this.instructions.push(dt,u),this.hitDetectionInstructions.push(dt,u),n.fillStyle!==void 0&&(this.instructions.push(ce),this.hitDetectionInstructions.push(ce)),n.strokeStyle!==void 0&&(this.instructions.push(st),this.hitDetectionInstructions.push(st)),this.endGeometry(e)}},i.prototype.drawPolygon=function(t,e){var n=this.state,r=n.fillStyle,s=n.strokeStyle;if(!(r===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_FILL_STYLE,et]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var o=t.getEnds(),h=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(h,0,o,l),this.endGeometry(e)}},i.prototype.drawMultiPolygon=function(t,e){var n=this.state,r=n.fillStyle,s=n.strokeStyle;if(!(r===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_FILL_STYLE,et]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);for(var o=t.getEndss(),h=t.getOrientedFlatCoordinates(),l=t.getStride(),u=0,f=0,c=o.length;f<c;++f)u=this.drawFlatCoordinatess_(h,u,o[f],l);this.endGeometry(e)}},i.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(t!==0)for(var e=this.coordinates,n=0,r=e.length;n<r;++n)e[n]=$i(e[n],t);return a.prototype.finish.call(this)},i.prototype.setFillStrokeStyles_=function(){var t=this.state,e=t.fillStyle;e!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)},i}(bt),gi=lr;function ur(a,i,t,e,n){var r=t,s=t,o=0,h=0,l=t,u,f,c,d,_,p,v,g,m,x;for(f=t;f<e;f+=n){var I=i[f],T=i[f+1];_!==void 0&&(m=I-_,x=T-p,d=Math.sqrt(m*m+x*x),v!==void 0&&(h+=c,u=Math.acos((v*m+g*x)/(c*d)),u>a&&(h>o&&(o=h,r=l,s=f),h=0,l=f-n)),c=d,v=m,g=x),_=I,p=T}return h+=d,h>o?[l,f]:[r,s]}var fr=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),de={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},cr=function(a){fr(i,a);function i(t,e,n,r){var s=a.call(this,t,e,n,r)||this;return s.labels_=null,s.text_="",s.textOffsetX_=0,s.textOffsetY_=0,s.textRotateWithView_=void 0,s.textRotation_=0,s.textFillState_=null,s.fillStates={},s.textStrokeState_=null,s.strokeStates={},s.textState_={},s.textStates={},s.textKey_="",s.fillKey_="",s.strokeKey_="",s.declutterImageWithText_=void 0,s}return i.prototype.finish=function(){var t=a.prototype.finish.call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t},i.prototype.drawText=function(t,e){var n=this.textFillState_,r=this.textStrokeState_,s=this.textState_;if(!(this.text_===""||!s||!n&&!r)){var o=this.coordinates,h=o.length,l=t.getType(),u=null,f=t.getStride();if(s.placement===bn.LINE&&(l==S.LINE_STRING||l==S.MULTI_LINE_STRING||l==S.POLYGON||l==S.MULTI_POLYGON)){if(!K(this.getBufferedMaxExtent(),t.getExtent()))return;var c=void 0;if(u=t.getFlatCoordinates(),l==S.LINE_STRING)c=[u.length];else if(l==S.MULTI_LINE_STRING)c=t.getEnds();else if(l==S.POLYGON)c=t.getEnds().slice(0,1);else if(l==S.MULTI_POLYGON){var d=t.getEndss();c=[];for(var _=0,p=d.length;_<p;++_)c.push(d[_][0])}this.beginGeometry(t,e);for(var v=s.textAlign,g=0,m=void 0,x=0,I=c.length;x<I;++x){if(v==null){var T=ur(s.maxAngle,u,g,c[x],f);g=T[0],m=T[1]}else m=c[x];for(var _=g;_<m;_+=f)o.push(u[_],u[_+1]);var O=o.length;g=c[x],this.drawChars_(h,O),h=O}this.endGeometry(e)}else{var w=s.overflow?null:[];switch(l){case S.POINT:case S.MULTI_POINT:u=t.getFlatCoordinates();break;case S.LINE_STRING:u=t.getFlatMidpoint();break;case S.CIRCLE:u=t.getCenter();break;case S.MULTI_LINE_STRING:u=t.getFlatMidpoints(),f=2;break;case S.POLYGON:u=t.getFlatInteriorPoint(),s.overflow||w.push(u[2]/this.resolution),f=3;break;case S.MULTI_POLYGON:var C=t.getFlatInteriorPoints();u=[];for(var _=0,p=C.length;_<p;_+=3)s.overflow||w.push(C[_+2]/this.resolution),u.push(C[_],C[_+1]);if(u.length===0)return;f=2;break}var O=this.appendFlatPointCoordinates(u,f);if(O===h)return;if(w&&(O-h)/2!=u.length/f){var R=h/2;w=w.filter(function(B,k){var N=o[(R+k)*2]===u[k*f]&&o[(R+k)*2+1]===u[k*f+1];return N||--R,N})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var F=s.padding;if(F!=ct&&(s.scale[0]<0||s.scale[1]<0)){var L=s.padding[0],D=s.padding[1],A=s.padding[2],P=s.padding[3];s.scale[0]<0&&(D=-D,P=-P),s.scale[1]<0&&(L=-L,A=-A),F=[L,D,A,P]}var b=this.pixelRatio;this.instructions.push([E.DRAW_IMAGE,h,O,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,F==ct?ct:F.map(function(B){return B*b}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,w]);var Y=1/b;this.hitDetectionInstructions.push([E.DRAW_IMAGE,h,O,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[Y,Y],NaN,this.declutterImageWithText_,F,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,w]),this.endGeometry(e)}}},i.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||Gt,textBaseline:e.textBaseline||ie,scale:e.scale});var o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))},i.prototype.drawChars_=function(t,e){var n=this.textStrokeState_,r=this.textState_,s=this.strokeKey_,o=this.textKey_,h=this.fillKey_;this.saveTextStates_();var l=this.pixelRatio,u=de[r.textBaseline],f=this.textOffsetY_*l,c=this.text_,d=n?n.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([E.DRAW_CHARS,t,e,u,r.overflow,h,r.maxAngle,l,f,s,d*l,c,o,1]),this.hitDetectionInstructions.push([E.DRAW_CHARS,t,e,u,r.overflow,h,r.maxAngle,1,f,s,d,c,o,1/l])},i.prototype.setTextStyle=function(t,e){var n,r,s;if(!t)this.text_="";else{var o=t.getFill();o?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=j(o.getColor()||et)):(r=null,this.textFillState_=r);var h=t.getStroke();if(!h)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);var l=h.getLineDash(),u=h.getLineDashOffset(),f=h.getWidth(),c=h.getMiterLimit();s.lineCap=h.getLineCap()||te,s.lineDash=l?l.slice():Mt,s.lineDashOffset=u===void 0?kt:u,s.lineJoin=h.getLineJoin()||_t,s.lineWidth=f===void 0?Ft:f,s.miterLimit=c===void 0?At:c,s.strokeStyle=j(h.getColor()||Dt)}n=this.textState_;var d=t.getFont()||ei;qi(d);var _=t.getScaleArray();n.overflow=t.getOverflow(),n.font=d,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.textBaseline=t.getTextBaseline()||ie,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||ct,n.scale=_===void 0?[1,1]:_;var p=t.getOffsetX(),v=t.getOffsetY(),g=t.getRotateWithView(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=p===void 0?0:p,this.textOffsetY_=v===void 0?0:v,this.textRotateWithView_=g===void 0?!1:g,this.textRotation_=m===void 0?0:m,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:X(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.textBaseline||"?"),this.fillKey_=r?typeof r.fillStyle=="string"?r.fillStyle:"|"+X(r.fillStyle):""}this.declutterImageWithText_=e},i}(bt),dr=cr,_r={Circle:gi,Default:bt,Image:rr,LineString:or,Polygon:gi,Text:dr},pr=function(){function a(i,t,e,n){this.tolerance_=i,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=e,this.buildersByZIndex_={}}return a.prototype.finish=function(){var i={};for(var t in this.buildersByZIndex_){i[t]=i[t]||{};var e=this.buildersByZIndex_[t];for(var n in e){var r=e[n].finish();i[t][n]=r}}return i},a.prototype.getBuilder=function(i,t){var e=i!==void 0?i.toString():"0",n=this.buildersByZIndex_[e];n===void 0&&(n={},this.buildersByZIndex_[e]=n);var r=n[t];if(r===void 0){var s=_r[t];r=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=r}return r},a}(),yi=pr,G={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function vr(a,i,t,e,n,r,s,o,h,l,u,f){var c=a[i],d=a[i+1],_=0,p=0,v=0,g=0;function m(){_=c,p=d,i+=e,c=a[i],d=a[i+1],g+=v,v=Math.sqrt((c-_)*(c-_)+(d-p)*(d-p))}do m();while(i<t-e&&g+v<r);for(var x=v===0?0:(r-g)/v,I=pt(_,c,x),T=pt(p,d,x),O=i-e,w=g,C=r+o*h(l,n,u);i<t-e&&g+v<C;)m();x=v===0?0:(C-g)/v;var R=pt(_,c,x),F=pt(p,d,x),L;if(f){var D=[I,T,R,F];Qi(D,0,4,2,f,D,D),L=D[0]>D[2]}else L=I>R;var A=Math.PI,P=[],b=O+e===i;i=O,v=0,g=w,c=a[i],d=a[i+1];var Y;if(b){m(),Y=Math.atan2(d-p,c-_),L&&(Y+=Y>0?-A:A);var M=(R+I)/2,B=(F+T)/2;return P[0]=[M,B,(C-r)/2,Y,n],P}for(var k=0,N=n.length;k<N;){m();var W=Math.atan2(d-p,c-_);if(L&&(W+=W>0?-A:A),Y!==void 0){var y=W-Y;if(y+=y>A?-2*A:y<-A?2*A:0,Math.abs(y)>s)return null}Y=W;for(var q=k,Q=0;k<N;++k){var It=L?N-k-1:k,Ht=o*h(l,n[It],u);if(i+e<t&&g+v<r+Q+Ht/2)break;Q+=Ht}if(k!==q){var _e=L?n.substring(N-q,N-k):n.substring(q,k);x=v===0?0:(r+Q/2-g)/v;var M=pt(_,c,x),B=pt(p,d,x);P.push([M,B,Q/2,W,_e]),r+=Q}}return P}var xt=ae(),ot=[],it=[],nt=[],ht=[];function mi(a){return a[3].declutterBox}var gr=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function xi(a,i){return(i==="start"||i==="end")&&!gr.test(a)&&(i=i==="start"?"left":"right"),de[i]}var yr=function(){function a(i,t,e,n){this.overlaps=e,this.pixelRatio=t,this.resolution=i,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=ne(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return a.prototype.createLabel=function(i,t,e,n){var r=i+t+e+n;if(this.labels_[r])return this.labels_[r];var s=n?this.strokeStates[n]:null,o=e?this.fillStates[e]:null,h=this.textStates[t],l=this.pixelRatio,u=[h.scale[0]*l,h.scale[1]*l],f=xi(i,h.textAlign||Gt),c=n&&s.lineWidth?s.lineWidth:0,d=i.split(`
`),_=d.length,p=[],v=tn(h.font,d,p),g=en(h.font),m=g*_,x=v+c,I=[],T=(x+2)*u[0],O=(m+c)*u[1],w={width:T<0?Math.floor(T):Math.ceil(T),height:O<0?Math.floor(O):Math.ceil(O),contextInstructions:I};if((u[0]!=1||u[1]!=1)&&I.push("scale",u),I.push("font",h.font),n){I.push("strokeStyle",s.strokeStyle),I.push("lineWidth",c),I.push("lineCap",s.lineCap),I.push("lineJoin",s.lineJoin),I.push("miterLimit",s.miterLimit);var C=nn?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;C.prototype.setLineDash&&(I.push("setLineDash",[s.lineDash]),I.push("lineDashOffset",s.lineDashOffset))}e&&I.push("fillStyle",o.fillStyle),I.push("textBaseline","middle"),I.push("textAlign","center");var R=.5-f,F=f*x+R*c,L;if(n)for(L=0;L<_;++L)I.push("strokeText",[d[L],F+R*p[L],.5*(c+g)+L*g]);if(e)for(L=0;L<_;++L)I.push("fillText",[d[L],F+R*p[L],.5*(c+g)+L*g]);return this.labels_[r]=w,w},a.prototype.replayTextBackground_=function(i,t,e,n,r,s,o){i.beginPath(),i.moveTo.apply(i,t),i.lineTo.apply(i,e),i.lineTo.apply(i,n),i.lineTo.apply(i,r),i.lineTo.apply(i,t),s&&(this.alignFill_=s[2],this.fill_(i)),o&&(this.setStrokeStyle_(i,o),i.stroke())},a.prototype.calculateImageOrLabelDimensions_=function(i,t,e,n,r,s,o,h,l,u,f,c,d,_,p,v){o*=c[0],h*=c[1];var g=e-o,m=n-h,x=r+l>i?i-l:r,I=s+u>t?t-u:s,T=_[3]+x*c[0]+_[1],O=_[0]+I*c[1]+_[2],w=g-_[3],C=m-_[0];(p||f!==0)&&(ot[0]=w,ht[0]=w,ot[1]=C,it[1]=C,it[0]=w+T,nt[0]=it[0],nt[1]=C+O,ht[1]=nt[1]);var R;return f!==0?(R=re(ne(),e,n,1,1,f,-e,-n),vt(R,ot),vt(R,it),vt(R,nt),vt(R,ht),we(Math.min(ot[0],it[0],nt[0],ht[0]),Math.min(ot[1],it[1],nt[1],ht[1]),Math.max(ot[0],it[0],nt[0],ht[0]),Math.max(ot[1],it[1],nt[1],ht[1]),xt)):we(Math.min(w,w+T),Math.min(C,C+O),Math.max(w,w+T),Math.max(C,C+O),xt),d&&(g=Math.round(g),m=Math.round(m)),{drawImageX:g,drawImageY:m,drawImageW:x,drawImageH:I,originX:l,originY:u,declutterBox:{minX:xt[0],minY:xt[1],maxX:xt[2],maxY:xt[3],value:v},canvasTransform:R,scale:c}},a.prototype.replayImageOrLabel_=function(i,t,e,n,r,s,o){var h=!!(s||o),l=n.declutterBox,u=i.canvas,f=o?o[2]*n.scale[0]/2:0,c=l.minX-f<=u.width/t&&l.maxX+f>=0&&l.minY-f<=u.height/t&&l.maxY+f>=0;return c&&(h&&this.replayTextBackground_(i,ot,it,nt,ht,s,o),rn(i,n.canvasTransform,r,e,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},a.prototype.fill_=function(i){if(this.alignFill_){var t=vt(this.renderedTransform_,[0,0]),e=512*this.pixelRatio;i.save(),i.translate(t[0]%e,t[1]%e),i.rotate(this.viewRotation_)}i.fill(),this.alignFill_&&i.restore()},a.prototype.setStrokeStyle_=function(i,t){i.strokeStyle=t[1],i.lineWidth=t[2],i.lineCap=t[3],i.lineJoin=t[4],i.miterLimit=t[5],i.setLineDash&&(i.lineDashOffset=t[7],i.setLineDash(t[6]))},a.prototype.drawLabelWithPointPlacement_=function(i,t,e,n){var r=this.textStates[t],s=this.createLabel(i,t,n,e),o=this.strokeStates[e],h=this.pixelRatio,l=xi(i,r.textAlign||Gt),u=de[r.textBaseline||ie],f=o&&o.lineWidth?o.lineWidth:0,c=s.width/h-2*r.scale[0],d=l*c+2*(.5-l)*f,_=u*s.height/h+2*(.5-u)*f;return{label:s,anchorX:d,anchorY:_}},a.prototype.execute_=function(i,t,e,n,r,s,o,h){var l;this.pixelCoordinates_&&ee(e,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=Pt(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),an(this.renderedTransform_,e));for(var u=0,f=n.length,c=0,d,_,p,v,g,m,x,I,T,O,w,C,R=0,F=0,L=null,D=null,A=this.coordinateCache_,P=this.viewRotation_,b=Math.round(Math.atan2(-e[1],e[0])*1e12)/1e12,Y={context:i,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:P},M=this.instructions!=n||this.overlaps?0:200,B,k,N,W;u<f;){var y=n[u],q=y[0];switch(q){case E.BEGIN_GEOMETRY:B=y[1],W=y[3],B.getGeometry()?o!==void 0&&!K(o,W.getExtent())?u=y[2]+1:++u:u=y[2];break;case E.BEGIN_PATH:R>M&&(this.fill_(i),R=0),F>M&&(i.stroke(),F=0),!R&&!F&&(i.beginPath(),v=NaN,g=NaN),++u;break;case E.CIRCLE:c=y[1];var Q=l[c],It=l[c+1],Ht=l[c+2],_e=l[c+3],Ne=Ht-Q,Be=_e-It,Ye=Math.sqrt(Ne*Ne+Be*Be);i.moveTo(Q+Ye,It),i.arc(Q,It,Ye,0,2*Math.PI,!0),++u;break;case E.CLOSE_PATH:i.closePath(),++u;break;case E.CUSTOM:c=y[1],d=y[2];var wi=y[3],Li=y[4],We=y.length==6?y[5]:void 0;Y.geometry=wi,Y.feature=B,u in A||(A[u]=[]);var St=A[u];We?We(l,c,d,2,St):(St[0]=l[c],St[1]=l[c+1],St.length=2),Li(St,Y),++u;break;case E.DRAW_IMAGE:c=y[1],d=y[2],I=y[3],_=y[4],p=y[5];var pe=y[6],Di=y[7],Fi=y[8],Ai=y[9],Xe=y[10],ve=y[11],Mi=y[12],zt=y[13],Tt=y[14];if(!I&&y.length>=19){T=y[18],O=y[19],w=y[20],C=y[21];var ge=this.drawLabelWithPointPlacement_(T,O,w,C);I=ge.label,y[3]=I;var ki=y[22];_=(ge.anchorX-ki)*this.pixelRatio,y[4]=_;var Gi=y[23];p=(ge.anchorY-Gi)*this.pixelRatio,y[5]=p,pe=I.height,y[6]=pe,zt=I.width,y[13]=zt}var ye=void 0;y.length>24&&(ye=y[24]);var me=void 0,Jt=void 0,Kt=void 0;y.length>16?(me=y[15],Jt=y[16],Kt=y[17]):(me=ct,Jt=!1,Kt=!1),Xe&&b?ve+=P:!Xe&&!b&&(ve-=P);for(var Pi=0;c<d;c+=2)if(!(ye&&ye[Pi++]<zt/this.pixelRatio)){var tt=this.calculateImageOrLabelDimensions_(I.width,I.height,l[c],l[c+1],zt,pe,_,p,Fi,Ai,ve,Mi,r,me,Jt||Kt,B),be=[i,t,I,tt,Di,Jt?L:null,Kt?D:null],jt=void 0,xe=void 0;if(h&&Tt){var Zt=d-c;if(!Tt[Zt]){Tt[Zt]=be;continue}if(jt=Tt[Zt],delete Tt[Zt],xe=mi(jt),h.collides(xe))continue}h&&h.collides(tt.declutterBox)||(jt&&(h&&h.insert(xe),this.replayImageOrLabel_.apply(this,jt)),h&&h.insert(tt.declutterBox),this.replayImageOrLabel_.apply(this,be))}++u;break;case E.DRAW_CHARS:var Ue=y[1],Ve=y[2],Ie=y[3],Ni=y[4];C=y[5];var Bi=y[6],He=y[7],ze=y[8];w=y[9];var Se=y[10];T=y[11],O=y[12];var Je=[y[13],y[13]],Te=this.textStates[O],Et=Te.font,Ct=[Te.scale[0]*He,Te.scale[1]*He],Ot=void 0;Et in this.widths_?Ot=this.widths_[Et]:(Ot={},this.widths_[Et]=Ot);var Ke=An(l,Ue,Ve,2),je=Math.abs(Ct[0])*ii(Et,T,Ot);if(Ni||je<=Ke){var Yi=this.textStates[O].textAlign,Wi=(Ke-je)*de[Yi],Rt=vr(l,Ue,Ve,2,T,Wi,Bi,Math.abs(Ct[0]),ii,Et,Ot,b?0:this.viewRotation_);t:if(Rt){var wt=[],rt=void 0,$t=void 0,qt=void 0,U=void 0,H=void 0;if(w)for(rt=0,$t=Rt.length;rt<$t;++rt){H=Rt[rt],qt=H[4],U=this.createLabel(qt,O,"",w),_=H[2]+(Ct[0]<0?-Se:Se),p=Ie*U.height+(.5-Ie)*2*Se*Ct[1]/Ct[0]-ze;var tt=this.calculateImageOrLabelDimensions_(U.width,U.height,H[0],H[1],U.width,U.height,_,p,0,0,H[3],Je,!1,ct,!1,B);if(h&&h.collides(tt.declutterBox))break t;wt.push([i,t,U,tt,1,null,null])}if(C)for(rt=0,$t=Rt.length;rt<$t;++rt){H=Rt[rt],qt=H[4],U=this.createLabel(qt,O,C,""),_=H[2],p=Ie*U.height-ze;var tt=this.calculateImageOrLabelDimensions_(U.width,U.height,H[0],H[1],U.width,U.height,_,p,0,0,H[3],Je,!1,ct,!1,B);if(h&&h.collides(tt.declutterBox))break t;wt.push([i,t,U,tt,1,null,null])}h&&h.load(wt.map(mi));for(var Ee=0,Xi=wt.length;Ee<Xi;++Ee)this.replayImageOrLabel_.apply(this,wt[Ee])}}++u;break;case E.END_GEOMETRY:if(s!==void 0){B=y[1];var Ze=s(B,W);if(Ze)return Ze}++u;break;case E.FILL:M?R++:this.fill_(i),++u;break;case E.MOVE_TO_LINE_TO:for(c=y[1],d=y[2],k=l[c],N=l[c+1],m=k+.5|0,x=N+.5|0,(m!==v||x!==g)&&(i.moveTo(k,N),v=m,g=x),c+=2;c<d;c+=2)k=l[c],N=l[c+1],m=k+.5|0,x=N+.5|0,(c==d-2||m!==v||x!==g)&&(i.lineTo(k,N),v=m,g=x);++u;break;case E.SET_FILL_STYLE:L=y,this.alignFill_=y[2],R&&(this.fill_(i),R=0,F&&(i.stroke(),F=0)),i.fillStyle=y[1],++u;break;case E.SET_STROKE_STYLE:D=y,F&&(i.stroke(),F=0),this.setStrokeStyle_(i,y),++u;break;case E.STROKE:M?F++:i.stroke(),++u;break;default:++u;break}}R&&this.fill_(i),F&&i.stroke()},a.prototype.execute=function(i,t,e,n,r,s){this.viewRotation_=n,this.execute_(i,t,e,this.instructions,r,void 0,void 0,s)},a.prototype.executeHitDetection=function(i,t,e,n,r){return this.viewRotation_=e,this.execute_(i,1,t,this.hitDetectionInstructions,!0,n,r)},a}(),mr=yr,ke=[G.POLYGON,G.CIRCLE,G.LINE_STRING,G.IMAGE,G.TEXT,G.DEFAULT],xr=function(){function a(i,t,e,n,r,s){this.maxExtent_=i,this.overlaps_=n,this.pixelRatio_=e,this.resolution_=t,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=ne(),this.createExecutors_(r)}return a.prototype.clip=function(i,t){var e=this.getClipCoords(t);i.beginPath(),i.moveTo(e[0],e[1]),i.lineTo(e[2],e[3]),i.lineTo(e[4],e[5]),i.lineTo(e[6],e[7]),i.clip()},a.prototype.createExecutors_=function(i){for(var t in i){var e=this.executorsByZIndex_[t];e===void 0&&(e={},this.executorsByZIndex_[t]=e);var n=i[t];for(var r in n){var s=n[r];e[r]=new mr(this.resolution_,this.pixelRatio_,this.overlaps_,s)}}},a.prototype.hasExecutors=function(i){for(var t in this.executorsByZIndex_)for(var e=this.executorsByZIndex_[t],n=0,r=i.length;n<r;++n)if(i[n]in e)return!0;return!1},a.prototype.forEachFeatureAtCoordinate=function(i,t,e,n,r,s){n=Math.round(n);var o=n*2+1,h=re(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-e,-i[0],-i[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=ft(o,o));var u=this.hitDetectionContext_;u.canvas.width!==o||u.canvas.height!==o?(u.canvas.width=o,u.canvas.height=o):l||u.clearRect(0,0,o,o);var f;this.renderBuffer_!==void 0&&(f=ae(),sn(f,i),Re(f,t*(this.renderBuffer_+n),f));var c=Ir(n),d;function _(O,w){for(var C=u.getImageData(0,0,o,o).data,R=0,F=c.length;R<F;R++)if(C[c[R]]>0){if(!s||d!==G.IMAGE&&d!==G.TEXT||s.indexOf(O)!==-1){var L=(c[R]-3)/4,D=n-L%o,A=n-(L/o|0),P=r(O,w,D*D+A*A);if(P)return P}u.clearRect(0,0,o,o);break}}var p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(Le);var v,g,m,x,I;for(v=p.length-1;v>=0;--v){var T=p[v].toString();for(m=this.executorsByZIndex_[T],g=ke.length-1;g>=0;--g)if(d=ke[g],x=m[d],x!==void 0&&(I=x.executeHitDetection(u,h,e,_,f),I))return I}},a.prototype.getClipCoords=function(i){var t=this.maxExtent_;if(!t)return null;var e=t[0],n=t[1],r=t[2],s=t[3],o=[e,n,e,s,r,s,r,n];return Pt(o,0,8,2,i,o),o},a.prototype.isEmpty=function(){return se(this.executorsByZIndex_)},a.prototype.execute=function(i,t,e,n,r,s,o){var h=Object.keys(this.executorsByZIndex_).map(Number);h.sort(Le),this.maxExtent_&&(i.save(),this.clip(i,e));var l=s||ke,u,f,c,d,_,p;for(o&&h.reverse(),u=0,f=h.length;u<f;++u){var v=h[u].toString();for(_=this.executorsByZIndex_[v],c=0,d=l.length;c<d;++c){var g=l[c];p=_[g],p!==void 0&&p.execute(i,t,e,n,r,o)}}this.maxExtent_&&i.restore()},a}(),Ge={};function Ir(a){if(Ge[a]!==void 0)return Ge[a];for(var i=a*2+1,t=a*a,e=new Array(t+1),n=0;n<=a;++n)for(var r=0;r<=a;++r){var s=n*n+r*r;if(s>t)break;var o=e[s];o||(o=[],e[s]=o),o.push(((a+n)*i+(a+r))*4+3),n>0&&o.push(((a-n)*i+(a+r))*4+3),r>0&&(o.push(((a+n)*i+(a-r))*4+3),n>0&&o.push(((a-n)*i+(a-r))*4+3))}for(var h=[],n=0,l=e.length;n<l;++n)e[n]&&h.push.apply(h,e[n]);return Ge[a]=h,h}var Ii=xr,Sr=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Tr=function(a){Sr(i,a);function i(t,e,n,r,s,o,h){var l=a.call(this)||this;return l.context_=t,l.pixelRatio_=e,l.extent_=n,l.transform_=r,l.viewRotation_=s,l.squaredTolerance_=o,l.userTransform_=h,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=ne(),l}return i.prototype.drawImages_=function(t,e,n,r){if(!!this.image_){var s=Pt(t,e,n,r,this.transform_,this.pixelCoordinates_),o=this.context_,h=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);var u=this.imageRotation_;this.imageRotateWithView_&&(u+=this.viewRotation_);for(var f=0,c=s.length;f<c;f+=2){var d=s[f]-this.imageAnchorX_,_=s[f+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var p=d+this.imageAnchorX_,v=_+this.imageAnchorY_;re(h,p,v,1,1,u,-p,-v),o.setTransform.apply(o,h),o.translate(p,v),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,_,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}},i.prototype.drawText_=function(t,e,n,r){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var s=Pt(t,e,n,r,this.transform_,this.pixelCoordinates_),o=this.context_,h=this.textRotation_;for(this.textRotateWithView_&&(h+=this.viewRotation_);e<n;e+=r){var l=s[e]+this.textOffsetX_,u=s[e+1]+this.textOffsetY_;if(h!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var f=re(this.tmpLocalTransform_,l,u,1,1,h,-l,-u);o.setTransform.apply(o,f),o.translate(l,u),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&o.strokeText(this.text_,l,u),this.textFillState_&&o.fillText(this.text_,l,u)}}},i.prototype.moveToLineTo_=function(t,e,n,r,s){var o=this.context_,h=Pt(t,e,n,r,this.transform_,this.pixelCoordinates_);o.moveTo(h[0],h[1]);var l=h.length;s&&(l-=2);for(var u=2;u<l;u+=2)o.lineTo(h[u],h[u+1]);return s&&o.closePath(),n},i.prototype.drawRings_=function(t,e,n,r){for(var s=0,o=n.length;s<o;++s)e=this.moveToLineTo_(t,e,n[s],r,!0);return e},i.prototype.drawCircle=function(t){if(!!K(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=on(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],r=e[3]-e[1],s=Math.sqrt(n*n+r*r),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}},i.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},i.prototype.setTransform=function(t){this.transform_=t},i.prototype.drawGeometry=function(t){var e=t.getType();switch(e){case S.POINT:this.drawPoint(t);break;case S.LINE_STRING:this.drawLineString(t);break;case S.POLYGON:this.drawPolygon(t);break;case S.MULTI_POINT:this.drawMultiPoint(t);break;case S.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case S.MULTI_POLYGON:this.drawMultiPolygon(t);break;case S.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case S.CIRCLE:this.drawCircle(t);break}},i.prototype.drawFeature=function(t,e){var n=e.getGeometryFunction()(t);!n||!K(this.extent_,n.getExtent())||(this.setStyle(e),this.drawGeometry(n))},i.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),n=0,r=e.length;n<r;++n)this.drawGeometry(e[n])},i.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)},i.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)},i.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!K(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){var r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}},i.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(!!K(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var n=this.context_,r=t.getFlatCoordinates(),s=0,o=t.getEnds(),h=t.getStride();n.beginPath();for(var l=0,u=o.length;l<u;++l)s=this.moveToLineTo_(r,s,o[l],h,!1);n.stroke()}if(this.text_!==""){var f=t.getFlatMidpoints();this.drawText_(f,0,f.length,2)}}},i.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!K(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var n=t.getFlatInteriorPoint();this.drawText_(n,0,2,2)}}},i.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!K(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getOrientedFlatCoordinates(),r=0,s=t.getEndss(),o=t.getStride();e.beginPath();for(var h=0,l=s.length;h<l;++h){var u=s[h];r=this.drawRings_(n,r,u,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var f=t.getFlatInteriorPoints();this.drawText_(f,0,f.length,2)}}},i.prototype.setContextFillState_=function(t){var e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},i.prototype.setContextStrokeState_=function(t){var e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(ee(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},i.prototype.setContextTextState_=function(t){var e=this.context_,n=this.contextTextState_,r=t.textAlign?t.textAlign:Gt;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=r&&(n.textAlign=r,e.textAlign=r),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})},i.prototype.setFillStrokeStyle=function(t,e){var n=this;if(!t)this.fillState_=null;else{var r=t.getColor();this.fillState_={fillStyle:j(r||et)}}if(!e)this.strokeState_=null;else{var s=e.getColor(),o=e.getLineCap(),h=e.getLineDash(),l=e.getLineDashOffset(),u=e.getLineJoin(),f=e.getWidth(),c=e.getMiterLimit(),d=h||Mt;this.strokeState_={lineCap:o!==void 0?o:te,lineDash:this.pixelRatio_===1?d:d.map(function(_){return _*n.pixelRatio_}),lineDashOffset:(l||kt)*this.pixelRatio_,lineJoin:u!==void 0?u:_t,lineWidth:(f!==void 0?f:Ft)*this.pixelRatio_,miterLimit:c!==void 0?c:At,strokeStyle:j(s||Dt)}}},i.prototype.setImageStyle=function(t){var e;if(!t||!(e=t.getSize())){this.image_=null;return}var n=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*this.pixelRatio_,this.imageAnchorY_=n[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_},i.prototype.setTextStyle=function(t){if(!t)this.text_="";else{var e=t.getFill();if(!e)this.textFillState_=null;else{var n=e.getColor();this.textFillState_={fillStyle:j(n||et)}}var r=t.getStroke();if(!r)this.textStrokeState_=null;else{var s=r.getColor(),o=r.getLineCap(),h=r.getLineDash(),l=r.getLineDashOffset(),u=r.getLineJoin(),f=r.getWidth(),c=r.getMiterLimit();this.textStrokeState_={lineCap:o!==void 0?o:te,lineDash:h||Mt,lineDashOffset:l||kt,lineJoin:u!==void 0?u:_t,lineWidth:f!==void 0?f:Ft,miterLimit:c!==void 0?c:At,strokeStyle:j(s||Dt)}}var d=t.getFont(),_=t.getOffsetX(),p=t.getOffsetY(),v=t.getRotateWithView(),g=t.getRotation(),m=t.getScaleArray(),x=t.getText(),I=t.getTextAlign(),T=t.getTextBaseline();this.textState_={font:d!==void 0?d:ei,textAlign:I!==void 0?I:Gt,textBaseline:T!==void 0?T:ie},this.text_=x!==void 0?x:"",this.textOffsetX_=_!==void 0?this.pixelRatio_*_:0,this.textOffsetY_=p!==void 0?this.pixelRatio_*p:0,this.textRotateWithView_=v!==void 0?v:!1,this.textRotation_=g!==void 0?g:0,this.textScale_=[this.pixelRatio_*m[0],this.pixelRatio_*m[1]]}},i}(vi),Er=Tr,lt={FRACTION:"fraction",PIXELS:"pixels"},z={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Cr=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ut=null,Or=function(a){Cr(i,a);function i(t,e,n,r,s,o){var h=a.call(this)||this;return h.hitDetectionImage_=null,h.image_=t||new Image,r!==null&&(h.image_.crossOrigin=r),h.canvas_={},h.color_=o,h.unlisten_=null,h.imageState_=s,h.size_=n,h.src_=e,h.tainted_,h}return i.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===V.LOADED){Ut||(Ut=ft(1,1)),Ut.drawImage(this.image_,0,0);try{Ut.getImageData(0,0,1,1),this.tainted_=!1}catch{Ut=null,this.tainted_=!0}}return this.tainted_===!0},i.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(Lt.CHANGE)},i.prototype.handleImageError_=function(){this.imageState_=V.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},i.prototype.handleImageLoad_=function(){this.imageState_=V.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},i.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},i.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},i.prototype.getImageState=function(){return this.imageState_},i.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],n=ft(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},i.prototype.getSize=function(){return this.size_},i.prototype.getSrc=function(){return this.src_},i.prototype.load=function(){if(this.imageState_==V.IDLE){this.imageState_=V.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=hn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},i.prototype.replaceColor_=function(t){if(!(!this.color_||this.canvas_[t]||this.imageState_!==V.LOADED)){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var n=e.getContext("2d");if(n.scale(t,t),n.drawImage(this.image_,0,0),n.globalCompositeOperation="multiply",n.globalCompositeOperation==="multiply"||this.isTainted_())n.fillStyle=ln(this.color_),n.fillRect(0,0,e.width/t,e.height/t),n.globalCompositeOperation="destination-in",n.drawImage(this.image_,0,0);else{for(var r=n.getImageData(0,0,e.width,e.height),s=r.data,o=this.color_[0]/255,h=this.color_[1]/255,l=this.color_[2]/255,u=this.color_[3],f=0,c=s.length;f<c;f+=4)s[f]*=o,s[f+1]*=h,s[f+2]*=l,s[f+3]*=u;n.putImageData(r,0,0)}}},i.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},i}(un);function Rr(a,i,t,e,n,r){var s=ni.get(i,e,r);return s||(s=new Or(a,i,t,e,n,r),ni.set(i,e,r,s)),s}var wr=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Lr=function(a){wr(i,a);function i(t){var e=this,n=t||{},r=n.opacity!==void 0?n.opacity:1,s=n.rotation!==void 0?n.rotation:0,o=n.scale!==void 0?n.scale:1,h=n.rotateWithView!==void 0?n.rotateWithView:!1;e=a.call(this,{opacity:r,rotation:s,scale:o,displacement:n.displacement!==void 0?n.displacement:[0,0],rotateWithView:h})||this,e.anchor_=n.anchor!==void 0?n.anchor:[.5,.5],e.normalizedAnchor_=null,e.anchorOrigin_=n.anchorOrigin!==void 0?n.anchorOrigin:z.TOP_LEFT,e.anchorXUnits_=n.anchorXUnits!==void 0?n.anchorXUnits:lt.FRACTION,e.anchorYUnits_=n.anchorYUnits!==void 0?n.anchorYUnits:lt.FRACTION,e.crossOrigin_=n.crossOrigin!==void 0?n.crossOrigin:null;var l=n.img!==void 0?n.img:null,u=n.imgSize!==void 0?n.imgSize:null,f=n.src;at(!(f!==void 0&&l),4),at(!l||l&&u,5),(f===void 0||f.length===0)&&l&&(f=l.src||X(l)),at(f!==void 0&&f.length>0,6);var c=n.src!==void 0?V.IDLE:V.LOADED;return e.color_=n.color!==void 0?qe(n.color):null,e.iconImage_=Rr(l,f,u,e.crossOrigin_,c,e.color_),e.offset_=n.offset!==void 0?n.offset:[0,0],e.offsetOrigin_=n.offsetOrigin!==void 0?n.offsetOrigin:z.TOP_LEFT,e.origin_=null,e.size_=n.size!==void 0?n.size:null,e}return i.prototype.clone=function(){var t=this.getScale();return new i({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:this.size_!==null?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},i.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(this.anchorXUnits_==lt.FRACTION||this.anchorYUnits_==lt.FRACTION){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==lt.FRACTION&&(t[0]*=e[0]),this.anchorYUnits_==lt.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=z.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_==z.TOP_RIGHT||this.anchorOrigin_==z.BOTTOM_RIGHT)&&(t[0]=-t[0]+e[0]),(this.anchorOrigin_==z.BOTTOM_LEFT||this.anchorOrigin_==z.BOTTOM_RIGHT)&&(t[1]=-t[1]+e[1])}var n=this.getDisplacement();return t[0]-=n[0],t[1]+=n[1],this.normalizedAnchor_=t,this.normalizedAnchor_},i.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},i.prototype.getColor=function(){return this.color_},i.prototype.getImage=function(t){return this.iconImage_.getImage(t)},i.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},i.prototype.getImageSize=function(){return this.iconImage_.getSize()},i.prototype.getImageState=function(){return this.iconImage_.getImageState()},i.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},i.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=z.TOP_LEFT){var e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_==z.TOP_RIGHT||this.offsetOrigin_==z.BOTTOM_RIGHT)&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_==z.BOTTOM_LEFT||this.offsetOrigin_==z.BOTTOM_RIGHT)&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_},i.prototype.getSrc=function(){return this.iconImage_.getSrc()},i.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},i.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(Lt.CHANGE,t)},i.prototype.load=function(){this.iconImage_.load()},i.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(Lt.CHANGE,t)},i}(hi),Dr=Lr,Z=.5;function Fr(a,i,t,e,n,r,s){var o=a[0]*Z,h=a[1]*Z,l=ft(o,h);l.imageSmoothingEnabled=!1;for(var u=l.canvas,f=new Er(l,Z,n,null,s),c=t.length,d=Math.floor((256*256*256-1)/c),_={},p=1;p<=c;++p){var v=t[p-1],g=v.getStyleFunction()||e;if(!!e){var m=g(v,r);if(!!m){Array.isArray(m)||(m=[m]);for(var x=p*d,I="#"+("000000"+x.toString(16)).slice(-6),T=0,O=m.length;T<O;++T){var w=m[T],C=w.getGeometryFunction()(v);if(!(!C||!K(n,C.getExtent()))){var R=w.clone(),F=R.getFill();F&&F.setColor(I);var L=R.getStroke();L&&(L.setColor(I),L.setLineDash(null)),R.setText(void 0);var D=w.getImage();if(D&&D.getOpacity()!==0){var A=D.getImageSize();if(!A)continue;var P=ft(A[0],A[1],void 0,{alpha:!1}),b=P.canvas;P.fillStyle=I,P.fillRect(0,0,b.width,b.height),R.setImage(new Dr({img:b,imgSize:A,anchor:D.getAnchor(),anchorXUnits:lt.PIXELS,anchorYUnits:lt.PIXELS,offset:D.getOrigin(),opacity:1,size:D.getSize(),scale:D.getScale(),rotation:D.getRotation(),rotateWithView:D.getRotateWithView()}))}var Y=R.getZIndex()||0,M=_[Y];M||(M={},_[Y]=M,M[S.POLYGON]=[],M[S.CIRCLE]=[],M[S.LINE_STRING]=[],M[S.POINT]=[]),M[C.getType().replace("Multi","")].push(C,R)}}}}}for(var B=Object.keys(_).map(Number).sort(Le),p=0,k=B.length;p<k;++p){var M=_[B[p]];for(var N in M)for(var W=M[N],T=0,O=W.length;T<O;T+=2){f.setStyle(W[T+1]);for(var y=0,q=i.length;y<q;++y)f.setTransform(i[y]),f.drawGeometry(W[T])}}return l.getImageData(0,0,u.width,u.height)}function Ar(a,i,t){var e=[];if(t){var n=Math.floor(Math.round(a[0])*Z),r=Math.floor(Math.round(a[1])*Z),s=(ri(n,0,t.width-1)+ri(r,0,t.height-1)*t.width)*4,o=t.data[s],h=t.data[s+1],l=t.data[s+2],u=l+256*(h+256*o),f=Math.floor((256*256*256-1)/i.length);u&&u%f==0&&e.push(i[u/f-1])}return e}var Mr=.5,Si={Point:br,LineString:Yr,Polygon:Vr,MultiPoint:Ur,MultiLineString:Wr,MultiPolygon:Xr,GeometryCollection:Br,Circle:Pr};function kr(a,i){return parseInt(X(a),10)-parseInt(X(i),10)}function Gr(a,i){var t=Pe(a,i);return t*t}function Pe(a,i){return Mr*a/i}function Pr(a,i,t,e,n){var r=t.getFill(),s=t.getStroke();if(r||s){var o=a.getBuilder(t.getZIndex(),G.CIRCLE);o.setFillStrokeStyle(r,s),o.drawCircle(i,e)}var h=t.getText();if(h&&h.getText()){var l=(n||a).getBuilder(t.getZIndex(),G.TEXT);l.setTextStyle(h),l.drawText(i,e)}}function Ti(a,i,t,e,n,r,s){var o=!1,h=t.getImage();if(h){var l=h.getImageState();l==V.LOADED||l==V.ERROR?h.unlistenImageChange(n):(l==V.IDLE&&h.load(),l=h.getImageState(),h.listenImageChange(n),o=!0)}return Nr(a,i,t,e,r,s),o}function Nr(a,i,t,e,n,r){var s=t.getGeometryFunction()(i);if(!!s){var o=s.simplifyTransformed(e,n),h=t.getRenderer();if(h)Ei(a,o,t,i);else{var l=Si[o.getType()];l(a,o,t,i,r)}}}function Ei(a,i,t,e){if(i.getType()==S.GEOMETRY_COLLECTION){for(var n=i.getGeometries(),r=0,s=n.length;r<s;++r)Ei(a,n[r],t,e);return}var o=a.getBuilder(t.getZIndex(),G.DEFAULT);o.drawCustom(i,e,t.getRenderer(),t.getHitDetectionRenderer())}function Br(a,i,t,e,n){var r=i.getGeometriesArray(),s,o;for(s=0,o=r.length;s<o;++s){var h=Si[r[s].getType()];h(a,r[s],t,e,n)}}function Yr(a,i,t,e,n){var r=t.getStroke();if(r){var s=a.getBuilder(t.getZIndex(),G.LINE_STRING);s.setFillStrokeStyle(null,r),s.drawLineString(i,e)}var o=t.getText();if(o&&o.getText()){var h=(n||a).getBuilder(t.getZIndex(),G.TEXT);h.setTextStyle(o),h.drawText(i,e)}}function Wr(a,i,t,e,n){var r=t.getStroke();if(r){var s=a.getBuilder(t.getZIndex(),G.LINE_STRING);s.setFillStrokeStyle(null,r),s.drawMultiLineString(i,e)}var o=t.getText();if(o&&o.getText()){var h=(n||a).getBuilder(t.getZIndex(),G.TEXT);h.setTextStyle(o),h.drawText(i,e)}}function Xr(a,i,t,e,n){var r=t.getFill(),s=t.getStroke();if(s||r){var o=a.getBuilder(t.getZIndex(),G.POLYGON);o.setFillStrokeStyle(r,s),o.drawMultiPolygon(i,e)}var h=t.getText();if(h&&h.getText()){var l=(n||a).getBuilder(t.getZIndex(),G.TEXT);l.setTextStyle(h),l.drawText(i,e)}}function br(a,i,t,e,n){var r=t.getImage(),s=t.getText(),o;if(n&&(a=n,o=r&&s&&s.getText()?{}:void 0),r){if(r.getImageState()!=V.LOADED)return;var h=a.getBuilder(t.getZIndex(),G.IMAGE);h.setImageStyle(r,o),h.drawPoint(i,e)}if(s&&s.getText()){var l=a.getBuilder(t.getZIndex(),G.TEXT);l.setTextStyle(s,o),l.drawText(i,e)}}function Ur(a,i,t,e,n){var r=t.getImage(),s=t.getText(),o;if(n&&(a=n,o=r&&s&&s.getText()?{}:void 0),r){if(r.getImageState()!=V.LOADED)return;var h=a.getBuilder(t.getZIndex(),G.IMAGE);h.setImageStyle(r,o),h.drawMultiPoint(i,e)}if(s&&s.getText()){var l=(n||a).getBuilder(t.getZIndex(),G.TEXT);l.setTextStyle(s,o),l.drawText(i,e)}}function Vr(a,i,t,e,n){var r=t.getFill(),s=t.getStroke();if(r||s){var o=a.getBuilder(t.getZIndex(),G.POLYGON);o.setFillStrokeStyle(r,s),o.drawPolygon(i,e)}var h=t.getText();if(h&&h.getText()){var l=(n||a).getBuilder(t.getZIndex(),G.TEXT);l.setTextStyle(h),l.drawText(i,e)}}var Hr=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),zr=function(a){Hr(i,a);function i(t){var e=a.call(this,t)||this;return e.boundHandleStyleImageChange_=e.handleStyleImageChange_.bind(e),e.animatingOrInteracting_,e.dirty_=!1,e.hitDetectionImageData_=null,e.renderedFeatures_=null,e.renderedRevision_=-1,e.renderedResolution_=NaN,e.renderedExtent_=ae(),e.wrappedRenderedExtent_=ae(),e.renderedRotation_,e.renderedCenter_=null,e.renderedProjection_=null,e.renderedRenderOrder_=null,e.replayGroup_=null,e.replayGroupChanged=!0,e.declutterExecutorGroup=null,e.clipping=!0,e}return i.prototype.useContainer=function(t,e,n){n<1&&(t=null),a.prototype.useContainer.call(this,t,e,n)},i.prototype.renderWorlds=function(t,e,n){var r=e.extent,s=e.viewState,o=s.center,h=s.resolution,l=s.projection,u=s.rotation,f=l.getExtent(),c=this.getLayer().getSource(),d=e.pixelRatio,_=e.viewHints,p=!(_[oe.ANIMATING]||_[oe.INTERACTING]),v=this.context,g=Math.round(e.size[0]*d),m=Math.round(e.size[1]*d),x=c.getWrapX()&&l.canWrapX(),I=x?he(f):null,T=x?Math.ceil((r[2]-f[2])/I)+1:1,O=x?Math.floor((r[0]-f[0])/I):0;do{var w=this.getRenderTransform(o,h,u,d,g,m,O*I);t.execute(v,1,w,u,p,void 0,n)}while(++O<T)},i.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree)},i.prototype.renderFrame=function(t,e){var n=t.pixelRatio,r=t.layerStatesArray[t.layerIndex];fn(this.pixelTransform,1/n,1/n),cn(this.inversePixelTransform,this.pixelTransform);var s=dn(this.pixelTransform);this.useContainer(e,s,r.opacity);var o=this.context,h=o.canvas,l=this.replayGroup_,u=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!u||u.isEmpty()))return null;var f=Math.round(t.size[0]*n),c=Math.round(t.size[1]*n);h.width!=f||h.height!=c?(h.width=f,h.height=c,h.style.transform!==s&&(h.style.transform=s)):this.containerReused||o.clearRect(0,0,f,c),this.preRender(o,t);var d=t.viewState;d.projection;var _=!1,p=!0;if(r.extent&&this.clipping){var v=_n(r.extent);p=K(v,t.extent),_=p&&!Nt(v,t.extent),_&&this.clipUnrotated(o,t,v)}p&&this.renderWorlds(l,t),_&&o.restore(),this.postRender(o,t);var g=pn(r.opacity),m=this.container;return g!==m.style.opacity&&(m.style.opacity=g),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container},i.prototype.getFeatures=function(t){return new Promise(function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var n=[this.context.canvas.width,this.context.canvas.height];vt(this.pixelTransform,n);var r=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,h=this.renderedProjection_,l=this.wrappedRenderedExtent_,u=this.getLayer(),f=[],c=n[0]*Z,d=n[1]*Z;f.push(this.getRenderTransform(r,s,o,Z,c,d,0).slice());var _=u.getSource(),p=h.getExtent();if(_.getWrapX()&&h.canWrapX()&&!Nt(p,l)){for(var v=l[0],g=he(p),m=0,x=void 0;v<p[0];)--m,x=g*m,f.push(this.getRenderTransform(r,s,o,Z,c,d,x).slice()),v+=g;for(m=0,v=l[2];v>p[2];)++m,x=g*m,f.push(this.getRenderTransform(r,s,o,Z,c,d,x).slice()),v-=g}this.hitDetectionImageData_=Fr(n,f,this.renderedFeatures_,u.getStyleFunction(),l,s,o)}e(Ar(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},i.prototype.forEachFeatureAtCoordinate=function(t,e,n,r,s){var o=this;if(!!this.replayGroup_){var h=e.viewState.resolution,l=e.viewState.rotation,u=this.getLayer(),f={},c=function(p,v,g){var m=X(p),x=f[m];if(x){if(x!==!0&&g<x.distanceSq){if(g===0)return f[m]=!0,s.splice(s.lastIndexOf(x),1),r(p,u,v);x.geometry=v,x.distanceSq=g}}else{if(g===0)return f[m]=!0,r(p,u,v);s.push(f[m]={feature:p,layer:u,geometry:v,distanceSq:g,callback:r})}},d,_=[this.replayGroup_];return this.declutterExecutorGroup&&_.push(this.declutterExecutorGroup),_.some(function(p){return d=p.forEachFeatureAtCoordinate(t,h,l,n,c,p===o.declutterExecutorGroup?e.declutterTree.all().map(function(v){return v.value}):null)}),d}},i.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},i.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},i.prototype.prepareFrame=function(t){var e=this.getLayer(),n=e.getSource();if(!n)return!1;var r=t.viewHints[oe.ANIMATING],s=t.viewHints[oe.INTERACTING],o=e.getUpdateWhileAnimating(),h=e.getUpdateWhileInteracting();if(!this.dirty_&&!o&&r||!h&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var l=t.extent,u=t.viewState,f=u.projection,c=u.resolution,d=t.pixelRatio,_=e.getRevision(),p=e.getRenderBuffer(),v=e.getRenderOrder();v===void 0&&(v=kr);var g=u.center.slice(),m=Re(l,p*c),x=m.slice(),I=[m.slice()],T=f.getExtent();if(n.getWrapX()&&f.canWrapX()&&!Nt(T,t.extent)){var O=he(T),w=Math.max(he(m)/2,O);m[0]=T[0]-w,m[2]=T[2]+w,vn(g,f);var C=gn(I[0],f);C[0]<T[0]&&C[2]<T[2]?I.push([C[0]+O,C[1],C[2]+O,C[3]]):C[0]>T[0]&&C[2]>T[2]&&I.push([C[0]-O,C[1],C[2]-O,C[3]])}if(!this.dirty_&&this.renderedResolution_==c&&this.renderedRevision_==_&&this.renderedRenderOrder_==v&&Nt(this.wrappedRenderedExtent_,m))return ee(this.renderedExtent_,x)||(this.hitDetectionImageData_=null,this.renderedExtent_=x),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var R=new yi(Pe(c,d),m,c,d),F;this.getLayer().getDeclutter()&&(F=new yi(Pe(c,d),m,c,d));for(var L,D,A,D=0,A=I.length;D<A;++D)n.loadFeatures(I[D],c,f);var P=Gr(c,d),b=function(N){var W,y=N.getStyleFunction()||e.getStyleFunction();if(y&&(W=y(N,c)),W){var q=this.renderFeature(N,P,W,R,L,F);this.dirty_=this.dirty_||q}}.bind(this),Y=mn(m),M=n.getFeaturesInExtent(Y);v&&M.sort(v);for(var D=0,A=M.length;D<A;++D)b(M[D]);this.renderedFeatures_=M;var B=R.finish(),k=new Ii(m,c,d,n.getOverlaps(),B,e.getRenderBuffer());return F&&(this.declutterExecutorGroup=new Ii(m,c,d,n.getOverlaps(),F.finish(),e.getRenderBuffer())),this.renderedResolution_=c,this.renderedRevision_=_,this.renderedRenderOrder_=v,this.renderedExtent_=x,this.wrappedRenderedExtent_=m,this.renderedCenter_=g,this.renderedProjection_=f,this.replayGroup_=k,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},i.prototype.renderFeature=function(t,e,n,r,s,o){if(!n)return!1;var h=!1;if(Array.isArray(n))for(var l=0,u=n.length;l<u;++l)h=Ti(r,t,n[l],e,this.boundHandleStyleImageChange_,s,o)||h;else h=Ti(r,t,n,e,this.boundHandleStyleImageChange_,s,o);return h},i}(yn),Jr=zr,Kr=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),jr=function(a){Kr(i,a);function i(t){return a.call(this,t)||this}return i.prototype.createRenderer=function(){return new Jr(this)},i}(qn),aa=jr,Zr=function(){function a(i){this.rbush_=new ci(i),this.items_={}}return a.prototype.insert=function(i,t){var e={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],value:t};this.rbush_.insert(e),this.items_[X(t)]=e},a.prototype.load=function(i,t){for(var e=new Array(t.length),n=0,r=t.length;n<r;n++){var s=i[n],o=t[n],h={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:o};e[n]=h,this.items_[X(o)]=h}this.rbush_.load(e)},a.prototype.remove=function(i){var t=X(i),e=this.items_[t];return delete this.items_[t],this.rbush_.remove(e)!==null},a.prototype.update=function(i,t){var e=this.items_[X(t)],n=[e.minX,e.minY,e.maxX,e.maxY];ai(n,i)||(this.remove(t),this.insert(i,t))},a.prototype.getAll=function(){var i=this.rbush_.all();return i.map(function(t){return t.value})},a.prototype.getInExtent=function(i){var t={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]},e=this.rbush_.search(t);return e.map(function(n){return n.value})},a.prototype.forEach=function(i){return this.forEach_(this.getAll(),i)},a.prototype.forEachInExtent=function(i,t){return this.forEach_(this.getInExtent(i),t)},a.prototype.forEach_=function(i,t){for(var e,n=0,r=i.length;n<r;n++)if(e=t(i[n]),e)return e;return e},a.prototype.isEmpty=function(){return se(this.items_)},a.prototype.clear=function(){this.rbush_.clear(),this.items_={}},a.prototype.getExtent=function(i){var t=this.rbush_.toJSON();return we(t.minX,t.minY,t.maxX,t.maxY,i)},a.prototype.concat=function(i){this.rbush_.load(i.rbush_.all());for(var t in i.items_)this.items_[t]=i.items_[t]},a}(),Ci=Zr,$={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function $r(a,i){return[[-1/0,-1/0,1/0,1/0]]}var Vt={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},qr=!1;function Qr(a,i,t,e,n,r,s){var o=new XMLHttpRequest;o.open("GET",typeof a=="function"?a(t,e,n):a,!0),i.getType()==Vt.ARRAY_BUFFER&&(o.responseType="arraybuffer"),o.withCredentials=qr,o.onload=function(h){if(!o.status||o.status>=200&&o.status<300){var l=i.getType(),u=void 0;l==Vt.JSON||l==Vt.TEXT?u=o.responseText:l==Vt.XML?(u=o.responseXML,u||(u=new DOMParser().parseFromString(o.responseText,"application/xml"))):l==Vt.ARRAY_BUFFER&&(u=o.response),u?r(i.readFeatures(u,{extent:t,featureProjection:n}),i.readProjection(u)):s()}else s()},o.onerror=s,o.send()}function Oi(a,i){return function(t,e,n,r,s){var o=this;Qr(a,i,t,e,n,function(h,l){o.addFeatures(h),r!==void 0&&r(h)},s||si)}}var Ri=globalThis&&globalThis.__extends||function(){var a=function(i,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},a(i,t)};return function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");a(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ut=function(a){Ri(i,a);function i(t,e,n){var r=a.call(this,t)||this;return r.feature=e,r.features=n,r}return i}(xn),ta=function(a){Ri(i,a);function i(t){var e=this,n=t||{};e=a.call(this,{attributions:n.attributions,projection:void 0,state:In.READY,wrapX:n.wrapX!==void 0?n.wrapX:!0})||this,e.on,e.once,e.un,e.loader_=si,e.format_=n.format,e.overlaps_=n.overlaps===void 0?!0:n.overlaps,e.url_=n.url,n.loader!==void 0?e.loader_=n.loader:e.url_!==void 0&&(at(e.format_,7),e.loader_=Oi(e.url_,e.format_)),e.strategy_=n.strategy!==void 0?n.strategy:$r;var r=n.useSpatialIndex!==void 0?n.useSpatialIndex:!0;e.featuresRtree_=r?new Ci:null,e.loadedExtentsRtree_=new Ci,e.loadingExtentsCount_=0,e.nullGeometryFeatures_={},e.idIndex_={},e.uidIndex_={},e.featureChangeKeys_={},e.featuresCollection_=null;var s,o;return Array.isArray(n.features)?o=n.features:n.features&&(s=n.features,o=s.getArray()),!r&&s===void 0&&(s=new Sn(o)),o!==void 0&&e.addFeaturesInternal(o),s!==void 0&&e.bindFeaturesCollection_(s),e}return i.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},i.prototype.addFeatureInternal=function(t){var e=X(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);var n=t.getGeometry();if(n){var r=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new ut($.ADDFEATURE,t))},i.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[Oe(e,Lt.CHANGE,this.handleFeatureChange_,this),Oe(e,Tn.PROPERTYCHANGE,this.handleFeatureChange_,this)]},i.prototype.addToIndex_=function(t,e){var n=!0,r=e.getId();return r!==void 0&&(r.toString()in this.idIndex_?n=!1:this.idIndex_[r.toString()]=e),n&&(at(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),n},i.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},i.prototype.addFeaturesInternal=function(t){for(var e=[],n=[],r=[],s=0,o=t.length;s<o;s++){var h=t[s],l=X(h);this.addToIndex_(l,h)&&n.push(h)}for(var s=0,u=n.length;s<u;s++){var h=n[s],l=X(h);this.setupChangeEvents_(l,h);var f=h.getGeometry();if(f){var c=f.getExtent();e.push(c),r.push(h)}else this.nullGeometryFeatures_[l]=h}this.featuresRtree_&&this.featuresRtree_.load(e,r);for(var s=0,d=n.length;s<d;s++)this.dispatchEvent(new ut($.ADDFEATURE,n[s]))},i.prototype.bindFeaturesCollection_=function(t){var e=!1;this.addEventListener($.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener($.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(oi.ADD,function(n){e||(e=!0,this.addFeature(n.element),e=!1)}.bind(this)),t.addEventListener(oi.REMOVE,function(n){e||(e=!0,this.removeFeature(n.element),e=!1)}.bind(this)),this.featuresCollection_=t},i.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){var n=this.featureChangeKeys_[e];n.forEach(Ce)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this));for(var r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var s=new ut($.CLEAR);this.dispatchEvent(s),this.changed()},i.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},i.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(r){var s=r.getGeometry();if(s.intersectsCoordinate(t))return e(r)})},i.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},i.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,function(n){var r=n.getGeometry();if(r.intersectsExtent(t)){var s=e(n);if(s)return s}})},i.prototype.getFeaturesCollection=function(){return this.featuresCollection_},i.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),se(this.nullGeometryFeatures_)||En(t,Cn(this.nullGeometryFeatures_))),t},i.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e},i.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_?this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},i.prototype.getClosestFeatureToCoordinate=function(t,e){var n=t[0],r=t[1],s=null,o=[NaN,NaN],h=1/0,l=[-1/0,-1/0,1/0,1/0],u=e||Rn;return this.featuresRtree_.forEachInExtent(l,function(f){if(u(f)){var c=f.getGeometry(),d=h;if(h=c.closestPointXY(n,r,o,h),h<d){s=f;var _=Math.sqrt(h);l[0]=n-_,l[1]=r-_,l[2]=n+_,l[3]=r+_}}}),s},i.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},i.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return e!==void 0?e:null},i.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return e!==void 0?e:null},i.prototype.getFormat=function(){return this.format_},i.prototype.getOverlaps=function(){return this.overlaps_},i.prototype.getUrl=function(){return this.url_},i.prototype.handleFeatureChange_=function(t){var e=t.target,n=X(e),r=e.getGeometry();if(!r)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{var s=r.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(s,e)):this.featuresRtree_&&this.featuresRtree_.update(s,e)}var o=e.getId();if(o!==void 0){var h=o.toString();this.idIndex_[h]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[h]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new ut($.CHANGEFEATURE,e))},i.prototype.hasFeature=function(t){var e=t.getId();return e!==void 0?e in this.idIndex_:X(t)in this.uidIndex_},i.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&se(this.nullGeometryFeatures_)},i.prototype.loadFeatures=function(t,e,n){for(var r=this.loadedExtentsRtree_,s=this.strategy_(t,e,n),o=function(f,c){var d=s[f],_=r.forEachInExtent(d,function(p){return Nt(p.extent,d)});_||(++h.loadingExtentsCount_,h.dispatchEvent(new ut($.FEATURESLOADSTART)),h.loader_.call(h,d,e,n,function(p){--this.loadingExtentsCount_,this.dispatchEvent(new ut($.FEATURESLOADEND,void 0,p))}.bind(h),function(){--this.loadingExtentsCount_,this.dispatchEvent(new ut($.FEATURESLOADERROR))}.bind(h)),r.insert(d,{extent:d.slice()}))},h=this,l=0,u=s.length;l<u;++l)o(l);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},i.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),a.prototype.refresh.call(this)},i.prototype.removeLoadedExtent=function(t){var e=this.loadedExtentsRtree_,n;e.forEachInExtent(t,function(r){if(ai(r.extent,t))return n=r,!0}),n&&e.remove(n)},i.prototype.removeFeature=function(t){var e=X(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t),this.changed()},i.prototype.removeFeatureInternal=function(t){var e=X(t);this.featureChangeKeys_[e].forEach(Ce),delete this.featureChangeKeys_[e];var n=t.getId();n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new ut($.REMOVEFEATURE,t))},i.prototype.removeFromIdIndex_=function(t){var e=!1;for(var n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}return e},i.prototype.setLoader=function(t){this.loader_=t},i.prototype.setUrl=function(t){at(this.format_,7),this.url_=t,this.setLoader(Oi(t,this.format_))},i}(On),sa=ta;export{qn as B,Er as C,Vt as F,Dr as I,aa as L,Nn as R,sa as S,bn as T,$ as V,ia as a,ra as b,le as c,De as d,li as e,na as f,Gr as g,Ci as h,An as l};
