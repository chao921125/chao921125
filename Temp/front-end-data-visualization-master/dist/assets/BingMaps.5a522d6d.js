import{_ as j,ag as f,ah as M,ai as b,B as F}from"./ol.bb58850a.js";import{e as A,c as E,b as U,d as G,a as K}from"./TileImage.0ebee0ae.js";import{j as k}from"./net.a0d7cd86.js";var B=globalThis&&globalThis.__extends||function(){var o=function(r,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])},o(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}();function C(o){var r=o[0],e=new Array(r),t=1<<r-1,i,a;for(i=0;i<r;++i)a=48,o[1]&t&&(a+=1),o[2]&t&&(a+=2),e[i]=String.fromCharCode(a),t>>=1;return e.join("")}var D='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>',q=function(o){B(r,o);function r(e){var t=this,i=e.hidpi!==void 0?e.hidpi:!1;t=o.call(this,{cacheSize:e.cacheSize,crossOrigin:"anonymous",imageSmoothing:e.imageSmoothing,opaque:!0,projection:j("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:f.LOADING,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:i?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection})||this,t.hidpi_=i,t.culture_=e.culture!==void 0?e.culture:"en-us",t.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,t.apiKey_=e.key,t.imagerySet_=e.imagerySet;var a="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+t.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+t.apiKey_+"&c="+t.culture_;return k(a,t.handleImageryMetadataResponse.bind(t),void 0,"jsonp"),t}return r.prototype.getApiKey=function(){return this.apiKey_},r.prototype.getImagerySet=function(){return this.imagerySet_},r.prototype.handleImageryMetadataResponse=function(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState(f.ERROR);return}var t=e.resourceSets[0].resources[0],i=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,a=this.getProjection(),T=A(a),h=this.hidpi_?2:1,x=t.imageWidth==t.imageHeight?t.imageWidth/h:[t.imageWidth/h,t.imageHeight/h],z=E({extent:T,minZoom:t.zoomMin,maxZoom:i,tileSize:x});this.tileGrid=z;var w=this.culture_,O=this.hidpi_;if(this.tileUrlFunction=U(t.imageUrlSubdomains.map(function(c){var s=[0,0,0],m=t.imageUrl.replace("{subdomain}",c).replace("{culture}",w);return function(n,v,p){if(n){G(n[0],n[1],n[2],s);var u=m;return O&&(u+="&dpi=d1&device=mobile"),u.replace("{quadkey}",C(s))}else return}})),t.imageryProviders){var P=M(j("EPSG:4326"),this.getProjection());this.setAttributions(function(c){var s=[],m=c.viewState,n=this.getTileGrid(),v=n.getZForResolution(m.resolution,this.zDirection),p=n.getTileCoordForCoordAndZ(m.center,v),u=p[0];return t.imageryProviders.map(function(y){for(var _=!1,S=y.coverageAreas,d=0,R=S.length;d<R;++d){var g=S[d];if(u>=g.zoomMin&&u<=g.zoomMax){var l=g.bbox,Z=[l[1],l[0],l[3],l[2]],I=b(Z,P);if(F(I,c.extent)){_=!0;break}}}_&&s.push(y.attribution)}),s.push(D),s}.bind(this))}this.setState(f.READY)},r}(K),H=q;export{H as B};
