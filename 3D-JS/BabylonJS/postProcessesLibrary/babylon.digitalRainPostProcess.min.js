!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("babylonjs")):"function"==typeof define&&define.amd?define("babylonjs-post-process",["babylonjs"],e):"object"==typeof exports?exports["babylonjs-post-process"]=e(require("babylonjs")):t.POSTPROCESSES=e(t.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,(t=>(()=>{"use strict";var e={520:e=>{e.exports=t}},o={};function i(t){var n=o[t];if(void 0!==n)return n.exports;var r=o[t]={exports:{}};return e[t](r,r.exports,i),r.exports}i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{i.d(n,{default:()=>g});var t={};i.r(t),i.d(t,{DigitalRainFontTexture:()=>f,DigitalRainPostProcess:()=>c});var e={};i.r(e),i.d(e,{DigitalRainFontTexture:()=>f,DigitalRainPostProcess:()=>c});var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},o(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function a(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a}Object.create,Object.create;var l=i(520);l.ShaderStore.ShadersStore.digitalrainPixelShader="varying vec2 vUV;uniform sampler2D textureSampler;uniform sampler2D digitalRainFont;uniform vec4 digitalRainFontInfos;uniform vec4 digitalRainOptions;uniform mat4 matrixSpeed;uniform float cosTimeZeroOne;float getLuminance(vec3 color)\n{return clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{float caracterSize=digitalRainFontInfos.x;float numChar=digitalRainFontInfos.y-1.0;float fontx=digitalRainFontInfos.z;float fonty=digitalRainFontInfos.w;float screenx=digitalRainOptions.x;float screeny=digitalRainOptions.y;float ratio=screeny/fonty;float columnx=float(floor((gl_FragCoord.x)/caracterSize));float tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;float tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;vec2 tileUV=vec2(tileX,tileY);vec4 tileColor=texture2D(textureSampler,tileUV);vec4 baseColor=texture2D(textureSampler,vUV);float tileLuminance=getLuminance(tileColor.rgb);int st=int(mod(columnx,4.0));float speed=cosTimeZeroOne*(sin(tileX*314.5)*0.5+0.6); \nfloat x=float(mod(gl_FragCoord.x,caracterSize))/fontx;float y=float(mod(speed+gl_FragCoord.y/screeny,1.0));y*=ratio;vec4 finalColor= texture2D(digitalRainFont,vec2(x,1.0-y));vec3 high=finalColor.rgb*(vec3(1.2,1.2,1.2)*pow(1.0-y,30.0));finalColor.rgb*=vec3(pow(tileLuminance,5.0),pow(tileLuminance,1.5),pow(tileLuminance,3.0));finalColor.rgb+=high;finalColor.rgb=clamp(finalColor.rgb,0.,1.);finalColor.a=1.0;finalColor= mix(finalColor,tileColor,digitalRainOptions.w);finalColor= mix(finalColor,baseColor,digitalRainOptions.z);gl_FragColor=finalColor;}";var f=function(t){function e(e,o,i,n){void 0===n&&(n=null);var r=t.call(this,n)||this;if(!(n=r.getScene()))return r;r.name=e,r._text,r._font,r.wrapU=l.Texture.CLAMP_ADDRESSMODE,r.wrapV=l.Texture.CLAMP_ADDRESSMODE;var a=r._getFontHeight(o),f=r._getFontWidth(o);r._charSize=Math.max(a.height,f);var c=r._charSize,d=Math.ceil(r._charSize*i.length);r._texture=n.getEngine().createDynamicTexture(c,d,!1,l.Texture.NEAREST_SAMPLINGMODE);var s=r.getSize(),g=document.createElement("canvas");g.width=s.width,g.height=s.height;var u=g.getContext("2d");u.textBaseline="top",u.font=o,u.fillStyle="white",u.imageSmoothingEnabled=!1;for(var h=0;h<i.length;h++)u.fillText(i[h],0,h*r._charSize-a.offset);return n.getEngine().updateDynamicTexture(r._texture,g,!1,!0),r}return r(e,t),Object.defineProperty(e.prototype,"charSize",{get:function(){return this._charSize},enumerable:!1,configurable:!0}),e.prototype._getFontWidth=function(t){var e=document.createElement("canvas").getContext("2d");return e.fillStyle="white",e.font=t,e.measureText("W").width},e.prototype._getFontHeight=function(t){var e=document.createElement("canvas"),o=e.getContext("2d");o.fillRect(0,0,e.width,e.height),o.textBaseline="top",o.fillStyle="white",o.font=t,o.fillText("jH|",0,0);for(var i=o.getImageData(0,0,e.width,e.height).data,n=-1,r=-1,a=0;a<e.height;a++)for(var l=0;l<e.width;l++){if(0!==i[4*(a*e.width+l)]){-1===n&&(n=a);break}if(l===e.width-1&&-1!==n){r=a,a=e.height;break}}return{height:r-n+1,offset:n-1}},e.prototype.clone=function(){return new e(this.name,this._font,this._text,this.getScene())},e.Parse=function(t,o){return l.SerializationHelper.Parse((function(){return new e(t.name,t.font,t.text,o)}),t,o,null)},a([(0,l.serialize)("font")],e.prototype,"_font",void 0),a([(0,l.serialize)("text")],e.prototype,"_text",void 0),e}(l.BaseTexture),c=function(t){function e(e,o,i){var n=t.call(this,e,"digitalrain",["digitalRainFontInfos","digitalRainOptions","cosTimeZeroOne","matrixSpeed"],["digitalRainFont"],{width:o.getEngine().getRenderWidth(),height:o.getEngine().getRenderHeight()},o,l.Texture.TRILINEAR_SAMPLINGMODE,o.getEngine(),!0)||this;n.mixToTile=0,n.mixToNormal=0,n.speed=.003;var r="15px Monospace",a="古池や蛙飛び込む水の音ふるいけやかわずとびこむみずのおと初しぐれ猿も小蓑をほしげ也はつしぐれさるもこみのをほしげなり江戸の雨何石呑んだ時鳥えどのあめなんごくのんだほととぎす";i&&("string"==typeof i?r=i:(r=i.font||r,n.mixToTile=i.mixToTile||n.mixToTile,n.mixToNormal=i.mixToNormal||n.mixToNormal)),n._digitalRainFontTexture=new f(e,r,a,o.getScene());var c=n._digitalRainFontTexture.getSize(),d=0,s=0,g=l.Matrix.FromValues(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random());return n.onApply=function(t){t.setTexture("digitalRainFont",n._digitalRainFontTexture),t.setFloat4("digitalRainFontInfos",n._digitalRainFontTexture.charSize,a.length,c.width,c.height),t.setFloat4("digitalRainOptions",n.width,n.height,n.mixToNormal,n.mixToTile),t.setMatrix("matrixSpeed",g),d+=n.speed,s=d,t.setFloat("cosTimeZeroOne",s)},n}return r(e,t),e}(l.PostProcess),d=void 0!==i.g?i.g:"undefined"!=typeof window?window:void 0;if(void 0!==d)for(var s in t)d.BABYLON[s]=t[s];const g=e})(),n.default})()));
//# sourceMappingURL=babylon.digitalRainPostProcess.min.js.map