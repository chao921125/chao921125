import{B as P,c as B,b as C,m as E,a as T,e as z,d as x,r as L,f as N}from"./index.04f38bd2.js";function a(e,o){this._bmap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=o,this._projection=new BMap.MercatorProjection}a.prototype.dimensions=["lng","lat"];a.prototype.setZoom=function(e){this._zoom=e};a.prototype.setCenter=function(e){this._center=this._projection.lngLatToPoint(new BMap.Point(e[0],e[1]))};a.prototype.setMapOffset=function(e){this._mapOffset=e};a.prototype.getBMap=function(){return this._bmap};a.prototype.dataToPoint=function(e){var o=new BMap.Point(e[0],e[1]),r=this._bmap.pointToOverlayPixel(o),n=this._mapOffset;return[r.x-n[0],r.y-n[1]]};a.prototype.pointToData=function(e){var o=this._mapOffset;return e=this._bmap.overlayPixelToPoint({x:e[0]+o[0],y:e[1]+o[1]}),[e.lng,e.lat]};a.prototype.getViewRect=function(){var e=this._api;return new P(0,0,e.getWidth(),e.getHeight())};a.prototype.getRoamTransform=function(){return B()};a.prototype.prepareCustoms=function(){var e=this.getViewRect();return{coordSys:{type:"bmap",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:C(this.dataToPoint,this),size:C(V,this)}}};function V(e,o){return o=o||[0,0],E([0,1],function(r){var n=o[r],t=e[r]/2,p=[],f=[];return p[r]=n-t,f[r]=n+t,p[1-r]=f[1-r]=o[1-r],Math.abs(this.dataToPoint(p)[r]-this.dataToPoint(f)[r])},this)}var _;a.dimensions=a.prototype.dimensions;function H(){function e(o){this._root=o}return e.prototype=new BMap.Overlay,e.prototype.initialize=function(o){return o.getPanes().labelPane.appendChild(this._root),this._root},e.prototype.draw=function(){},e}a.create=function(e,o){var r,n=o.getDom();e.eachComponent("bmap",function(t){var p=o.getZr().painter,f=p.getViewportRoot();if(typeof BMap=="undefined")throw new Error("BMap api is not loaded");if(_=_||H(),r)throw new Error("Only one bmap component can exist");var i;if(!t.__bmap){var s=n.querySelector(".ec-extension-bmap");s&&(f.style.left="0px",f.style.top="0px",n.removeChild(s)),s=document.createElement("div"),s.className="ec-extension-bmap",s.style.cssText="position:absolute;width:100%;height:100%",n.appendChild(s);var l=t.get("mapOptions");l&&(l=T(l),delete l.mapType),i=t.__bmap=new BMap.Map(s,l);var g=new _(f);i.addOverlay(g),p.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}i=t.__bmap;var y=t.get("center"),m=t.get("zoom");if(y&&m){var v=i.getCenter(),c=i.getZoom(),u=t.centerOrZoomChanged([v.lng,v.lat],c);if(u){var S=new BMap.Point(y[0],y[1]);i.centerAndZoom(S,m)}}r=new a(i,o),r.setMapOffset(t.__mapOffset||[0,0]),r.setZoom(m),r.setCenter(y),t.coordinateSystem=r}),e.eachSeries(function(t){t.get("coordinateSystem")==="bmap"&&(t.coordinateSystem=r)})};function R(e,o){return e&&o&&e[0]===o[0]&&e[1]===o[1]}z({type:"bmap",getBMap:function(){return this.__bmap},setCenterAndZoom:function(e,o){this.option.center=e,this.option.zoom=o},centerOrZoomChanged:function(e,o){var r=this.option;return!(R(e,r.center)&&o===r.zoom)},defaultOption:{center:[104.114129,37.550339],zoom:5,mapStyle:{},mapStyleV2:{},mapOptions:{},roam:!1}});function Z(e){for(var o in e)if(e.hasOwnProperty(o))return!1;return!0}x({type:"bmap",render:function(e,o,r){var n=!0,t=e.getBMap(),p=r.getZr().painter.getViewportRoot(),f=e.coordinateSystem,i=function(S,A){if(!n){var w=p.parentNode.parentNode.parentNode,d=[-parseInt(w.style.left,10)||0,-parseInt(w.style.top,10)||0],h=p.style,O=d[0]+"px",b=d[1]+"px";h.left!==O&&(h.left=O),h.top!==b&&(h.top=b),f.setMapOffset(d),e.__mapOffset=d,r.dispatchAction({type:"bmapRoam",animation:{duration:0}})}};function s(){n||r.dispatchAction({type:"bmapRoam",animation:{duration:0}})}t.removeEventListener("moving",this._oldMoveHandler),t.removeEventListener("moveend",this._oldMoveHandler),t.removeEventListener("zoomend",this._oldZoomEndHandler),t.addEventListener("moving",i),t.addEventListener("moveend",i),t.addEventListener("zoomend",s),this._oldMoveHandler=i,this._oldZoomEndHandler=s;var l=e.get("roam");l&&l!=="scale"?t.enableDragging():t.disableDragging(),l&&l!=="move"?(t.enableScrollWheelZoom(),t.enableDoubleClickZoom(),t.enablePinchToZoom()):(t.disableScrollWheelZoom(),t.disableDoubleClickZoom(),t.disablePinchToZoom());var g=e.__mapStyle,y=e.get("mapStyle")||{},m=JSON.stringify(y);JSON.stringify(g)!==m&&(Z(y)||t.setMapStyle(T(y)),e.__mapStyle=JSON.parse(m));var v=e.__mapStyle2,c=e.get("mapStyleV2")||{},u=JSON.stringify(c);JSON.stringify(v)!==u&&(Z(c)||t.setMapStyleV2(T(c)),e.__mapStyle2=JSON.parse(u)),n=!1}});L("bmap",a);N({type:"bmapRoam",event:"bmapRoam",update:"updateLayout"},function(e,o){o.eachComponent("bmap",function(r){var n=r.getBMap(),t=n.getCenter();r.setCenterAndZoom([t.lng,t.lat],n.getZoom())})});var J=[{featureType:"water",elementType:"all",stylers:{color:"#d1d1d1"}},{featureType:"land",elementType:"all",stylers:{color:"#f3f3f3"}},{featureType:"railway",elementType:"all",stylers:{visibility:"off"}},{featureType:"highway",elementType:"all",stylers:{color:"#fdfdfd"}},{featureType:"highway",elementType:"labels",stylers:{visibility:"off"}},{featureType:"arterial",elementType:"geometry",stylers:{color:"#fefefe"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#fefefe"}},{featureType:"poi",elementType:"all",stylers:{visibility:"off"}},{featureType:"green",elementType:"all",stylers:{visibility:"off"}},{featureType:"subway",elementType:"all",stylers:{visibility:"off"}},{featureType:"manmade",elementType:"all",stylers:{color:"#d1d1d1"}},{featureType:"local",elementType:"all",stylers:{color:"#d1d1d1"}},{featureType:"arterial",elementType:"labels",stylers:{visibility:"off"}},{featureType:"boundary",elementType:"all",stylers:{color:"#fefefe"}},{featureType:"building",elementType:"all",stylers:{color:"#d1d1d1"}},{featureType:"label",elementType:"labels.text.fill",stylers:{color:"#999999"}}];export{J as a};
