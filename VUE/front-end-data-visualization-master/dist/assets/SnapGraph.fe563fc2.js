import{A as Ce,b as q,I as Fe,C as me,o as X,e as $,J as Se,L as Te,f as ie,F as ne,g as we,u as Pe,s as Ie,v as Ge,t as Me}from"./vendor.b99b632f.js";import{T as Le}from"./TileImage.0ebee0ae.js";import{O as be}from"./OSM.7622e957.js";import{h as ae,L as oe,S as se,V as K,a as Re,f as Oe,b as Ne,d as ue,c as Be,e as Ae}from"./Vector.c1a6c122.js";import{a7 as Ve,ct as Ue,cu as ke,cv as Ye,cn as qe,ar as p,b2 as le,b4 as D,E as j,A as E,ce as z,bc as Ke,cp as H,cw as J,ck as C,j as m,cx as M,cr as he,cy as De,h as He,b0 as We,aD as Xe,cl as L,aB as $e,bG as fe,cz as W,cA as de,ca as V,cB as ve,b7 as je,cj as ze,g as Je,Q as U,b6 as Qe,R as _e,cC as Ze,M as et,V as tt}from"./ol.bb58850a.js";import{_ as rt}from"./index.8bb5b140.js";import{D as it}from"./Draw.f5c30f6c.js";import"./XYZ.0d304f3a.js";import"./LineString.191ddcd6.js";import"./MultiPolygon.abfd4d82.js";var ge=globalThis&&globalThis.__extends||function(){var _=function(s,t){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},_(s,t)};return function(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");_(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),pe=0,k=1,ce=[0,0,0,0],N=[],Q={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"},Z=function(_){ge(s,_);function s(t,e,i){var r=_.call(this,t)||this;return r.features=e,r.mapBrowserEvent=i,r}return s}(Ve),nt=function(_){ge(s,_);function s(t){var e=_.call(this,t)||this;e.on,e.once,e.un,e.boundHandleFeatureChange_=e.handleFeatureChange_.bind(e),e.condition_=t.condition?t.condition:Ue,e.defaultDeleteCondition_=function(r){return ke(r)&&Ye(r)},e.deleteCondition_=t.deleteCondition?t.deleteCondition:e.defaultDeleteCondition_,e.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:qe,e.vertexFeature_=null,e.vertexSegments_=null,e.lastPixel_=[0,0],e.ignoreNextSingleClick_=!1,e.featuresBeingModified_=null,e.rBush_=new ae,e.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,e.snappedToVertex_=!1,e.changingFeature_=!1,e.dragSegments_=[],e.overlay_=new oe({source:new se({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:ot(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.SEGMENT_WRITERS_={Point:e.writePointGeometry_.bind(e),LineString:e.writeLineStringGeometry_.bind(e),LinearRing:e.writeLineStringGeometry_.bind(e),Polygon:e.writePolygonGeometry_.bind(e),MultiPoint:e.writeMultiPointGeometry_.bind(e),MultiLineString:e.writeMultiLineStringGeometry_.bind(e),MultiPolygon:e.writeMultiPolygonGeometry_.bind(e),Circle:e.writeCircleGeometry_.bind(e),GeometryCollection:e.writeGeometryCollectionGeometry_.bind(e)},e.source_=null,e.hitDetection_=null;var i;if(t.features?i=t.features:t.source&&(e.source_=t.source,i=new le(e.source_.getFeatures()),e.source_.addEventListener(K.ADDFEATURE,e.handleSourceAdd_.bind(e)),e.source_.addEventListener(K.REMOVEFEATURE,e.handleSourceRemove_.bind(e))),!i)throw new Error("The modify interaction requires features, a source or a layer");return t.hitDetection&&(e.hitDetection_=t.hitDetection),e.features_=i,e.features_.forEach(e.addFeature_.bind(e)),e.features_.addEventListener(D.ADD,e.handleFeatureAdd_.bind(e)),e.features_.addEventListener(D.REMOVE,e.handleFeatureRemove_.bind(e)),e.lastPointerEvent_=null,e.delta_=[0,0],e.snapToPointer_=t.snapToPointer===void 0?!e.hitDetection_:t.snapToPointer,e}return s.prototype.addFeature_=function(t){var e=t.getGeometry();if(e){var i=this.SEGMENT_WRITERS_[e.getType()];i&&i(t,e)}var r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,r),t.addEventListener(j.CHANGE,this.boundHandleFeatureChange_)},s.prototype.willModifyFeatures_=function(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new le;for(var i=this.featuresBeingModified_.getArray(),r=0,n=e.length;r<n;++r)for(var o=e[r],a=0,l=o.length;a<l;++a){var u=o[a].feature;u&&i.indexOf(u)===-1&&this.featuresBeingModified_.push(u)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Z(Q.MODIFYSTART,this.featuresBeingModified_,t))}},s.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(j.CHANGE,this.boundHandleFeatureChange_)},s.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,i=[];e.forEach(function(a){t===a.feature&&i.push(a)});for(var r=i.length-1;r>=0;--r){for(var n=i[r],o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===n&&this.dragSegments_.splice(o,1);e.remove(n)}},s.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),_.prototype.setActive.call(this,t)},s.prototype.setMap=function(t){this.overlay_.setMap(t),_.prototype.setMap.call(this,t)},s.prototype.getOverlay=function(){return this.overlay_},s.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},s.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},s.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},s.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},s.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},s.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)},s.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r){var o=i[r],a={feature:t,geometry:e,depth:[r],index:r,segment:[o,o]};this.rBush_.insert(e.getExtent(),a)}},s.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length-1;r<n;++r){var o=i.slice(r,r+2),a={feature:t,geometry:e,index:r,segment:o};this.rBush_.insert(E(o),a)}},s.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],a=0,l=o.length-1;a<l;++a){var u=o.slice(a,a+2),h={feature:t,geometry:e,depth:[r],index:a,segment:u};this.rBush_.insert(E(u),h)}},s.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],a=0,l=o.length-1;a<l;++a){var u=o.slice(a,a+2),h={feature:t,geometry:e,depth:[r],index:a,segment:u};this.rBush_.insert(E(u),h)}},s.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],a=0,l=o.length;a<l;++a)for(var u=o[a],h=0,g=u.length-1;h<g;++h){var d=u.slice(h,h+2),v={feature:t,geometry:e,depth:[a,r],index:h,segment:d};this.rBush_.insert(E(d),v)}},s.prototype.writeCircleGeometry_=function(t,e){var i=e.getCenter(),r={feature:t,geometry:e,index:pe,segment:[i,i]},n={feature:t,geometry:e,index:k,segment:[i,i]},o=[r,n];r.featureSegments=o,n.featureSegments=o,this.rBush_.insert(z(i),r);var a=e;this.rBush_.insert(a.getExtent(),n)},s.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r){var n=i[r],o=this.SEGMENT_WRITERS_[n.getType()];o(t,n)}},s.prototype.createOrUpdateVertexFeature_=function(t,e,i){var r=this.vertexFeature_;if(!r)r=new Re(new Ke(t)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r);else{var n=r.getGeometry();n.setCoordinates(t)}return r.set("features",e),r.set("geometries",i),r},s.prototype.handleEvent=function(t){if(!t.originalEvent)return!0;this.lastPointerEvent_=t;var e;return!t.map.getView().getInteracting()&&t.type==H.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(t.type!=H.SINGLECLICK||!this.ignoreNextSingleClick_?e=this.removePoint():e=!0),t.type==H.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),_.prototype.handleEvent.call(this,t)&&!e},s.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_);for(var e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],r=[],n=0,o=this.dragSegments_.length;n<o;++n){var a=this.dragSegments_[n],l=a[0],u=l.feature;i.indexOf(u)===-1&&i.push(u);var h=l.geometry;r.indexOf(h)===-1&&r.push(h);for(var g=l.depth,d=void 0,v=l.segment,f=a[1];e.length<h.getStride();)e.push(v[f][e.length]);switch(h.getType()){case p.POINT:d=e,v[0]=e,v[1]=e;break;case p.MULTI_POINT:d=h.getCoordinates(),d[l.index]=e,v[0]=e,v[1]=e;break;case p.LINE_STRING:d=h.getCoordinates(),d[l.index+f]=e,v[f]=e;break;case p.MULTI_LINE_STRING:d=h.getCoordinates(),d[g[0]][l.index+f]=e,v[f]=e;break;case p.POLYGON:d=h.getCoordinates(),d[g[0]][l.index+f]=e,v[f]=e;break;case p.MULTI_POLYGON:d=h.getCoordinates(),d[g[1]][g[0]][l.index+f]=e,v[f]=e;break;case p.CIRCLE:if(v[0]=e,v[1]=e,l.index===pe)this.changingFeature_=!0,h.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;var c=t.map.getView().getProjection(),y=J(C(h.getCenter()),C(e)),F=V();if(F){var x=h.clone().transform(F,c);x.setRadius(y),y=x.transform(c,F).getRadius()}h.setRadius(y),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(h,d)}this.createOrUpdateVertexFeature_(e,i,r)},s.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;var e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;var i=this.vertexFeature_;if(i){var r=t.map.getView().getProjection(),n=[],o=i.getGeometry().getCoordinates(),a=E([o]),l=this.rBush_.getInExtent(a),u={};l.sort(at);for(var h=0,g=l.length;h<g;++h){var d=l[h],v=d.segment,f=m(d.geometry),c=d.depth;if(c&&(f+="-"+c.join("-")),u[f]||(u[f]=new Array(2)),d.geometry.getType()===p.CIRCLE&&d.index===k){var y=xe(e,d,r);M(y,o)&&!u[f][0]&&(this.dragSegments_.push([d,0]),u[f][0]=d);continue}if(M(v[0],o)&&!u[f][0]){this.dragSegments_.push([d,0]),u[f][0]=d;continue}if(M(v[1],o)&&!u[f][1]){if((d.geometry.getType()===p.LINE_STRING||d.geometry.getType()===p.MULTI_LINE_STRING)&&u[f][0]&&u[f][0].index===0)continue;this.dragSegments_.push([d,1]),u[f][1]=d;continue}m(v)in this.vertexSegments_&&!u[f][0]&&!u[f][1]&&this.insertVertexCondition_(t)&&n.push(d)}n.length&&this.willModifyFeatures_(t,[n]);for(var F=n.length-1;F>=0;--F)this.insertVertex_(n[F],o)}return!!this.vertexFeature_},s.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var i=this.dragSegments_[e][0],r=i.geometry;if(r.getType()===p.CIRCLE){var n=r.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=n,o.segment[1]=n,a.segment[0]=n,a.segment[1]=n,this.rBush_.update(z(n),o);var l=r,u=V();if(u){var h=t.map.getView().getProjection();l=l.clone().transform(u,h),l=he(l).transform(h,u)}this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(E(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Z(Q.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1},s.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)},s.prototype.handlePointerAtPixel_=function(t,e,i){var r=this,n=i||e.getCoordinateFromPixel(t),o=e.getView().getProjection(),a=function(G,te){return ye(n,G,o)-ye(n,te,o)},l,u;if(this.hitDetection_){var h=typeof this.hitDetection_=="object"?function(G){return G===r.hitDetection_}:void 0;e.forEachFeatureAtPixel(t,function(G,te,O){if(O=O||G.getGeometry(),O.getType()===p.POINT&&De(r.features_.getArray(),G)){u=O;var re=O.getFlatCoordinates().slice(0,2);l=[{feature:G,geometry:O,segment:[re,re]}]}return!0},{layerFilter:h})}if(!l){var g=He(z(n,ce)),d=e.getView().getResolution()*this.pixelTolerance_,v=We(Xe(g,d,ce));l=this.rBush_.getInExtent(v)}if(l&&l.length>0){var f=l.sort(a)[0],c=f.segment,y=xe(n,f,o),F=e.getPixelFromCoordinate(y),x=J(t,F);if(u||x<=this.pixelTolerance_){var w={};if(w[m(c)]=!0,this.snapToPointer_||(this.delta_[0]=y[0]-n[0],this.delta_[1]=y[1]-n[1]),f.geometry.getType()===p.CIRCLE&&f.index===k)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(y,[f.feature],[f.geometry]);else{var A=e.getPixelFromCoordinate(c[0]),P=e.getPixelFromCoordinate(c[1]),S=L(F,A),b=L(F,P);x=Math.sqrt(Math.min(S,b)),this.snappedToVertex_=x<=this.pixelTolerance_,this.snappedToVertex_&&(y=S>b?c[1]:c[0]),this.createOrUpdateVertexFeature_(y,[f.feature],[f.geometry]);var R={};R[m(f.geometry)]=!0;for(var T=1,Y=l.length;T<Y;++T){var I=l[T].segment;if(M(c[0],I[0])&&M(c[1],I[1])||M(c[0],I[1])&&M(c[1],I[0])){var ee=m(l[T].geometry);ee in R||(R[ee]=!0,w[m(I)]=!0)}else break}}this.vertexSegments_=w;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},s.prototype.insertVertex_=function(t,e){for(var i=t.segment,r=t.feature,n=t.geometry,o=t.depth,a=t.index,l;e.length<n.getStride();)e.push(0);switch(n.getType()){case p.MULTI_LINE_STRING:l=n.getCoordinates(),l[o[0]].splice(a+1,0,e);break;case p.POLYGON:l=n.getCoordinates(),l[o[0]].splice(a+1,0,e);break;case p.MULTI_POLYGON:l=n.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,e);break;case p.LINE_STRING:l=n.getCoordinates(),l.splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(n,l);var u=this.rBush_;u.remove(t),this.updateSegmentIndices_(n,a,o,1);var h={segment:[i[0],e],feature:r,geometry:n,depth:o,index:a};u.insert(E(h.segment),h),this.dragSegments_.push([h,1]);var g={segment:[e,i[1]],feature:r,geometry:n,depth:o,index:a+1};u.insert(E(g.segment),g),this.dragSegments_.push([g,0]),this.ignoreNextSingleClick_=!0},s.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=H.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_);var e=this.removeVertex_();return this.dispatchEvent(new Z(Q.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,e}return!1},s.prototype.removeVertex_=function(){var t=this.dragSegments_,e={},i=!1,r,n,o,a,l,u,h,g,d,v,f;for(l=t.length-1;l>=0;--l)o=t[l],v=o[0],f=m(v.feature),v.depth&&(f+="-"+v.depth.join("-")),f in e||(e[f]={}),o[1]===0?(e[f].right=v,e[f].index=v.index):o[1]==1&&(e[f].left=v,e[f].index=v.index+1);for(f in e){switch(d=e[f].right,h=e[f].left,u=e[f].index,g=u-1,h!==void 0?v=h:v=d,g<0&&(g=0),a=v.geometry,n=a.getCoordinates(),r=n,i=!1,a.getType()){case p.MULTI_LINE_STRING:n[v.depth[0]].length>2&&(n[v.depth[0]].splice(u,1),i=!0);break;case p.LINE_STRING:n.length>2&&(n.splice(u,1),i=!0);break;case p.MULTI_POLYGON:r=r[v.depth[1]];case p.POLYGON:r=r[v.depth[0]],r.length>4&&(u==r.length-1&&(u=0),r.splice(u,1),i=!0,u===0&&(r.pop(),r.push(r[0]),g=r.length-1));break}if(i){this.setGeometryCoordinates_(a,n);var c=[];if(h!==void 0&&(this.rBush_.remove(h),c.push(h.segment[0])),d!==void 0&&(this.rBush_.remove(d),c.push(d.segment[1])),h!==void 0&&d!==void 0){var y={depth:v.depth,feature:v.feature,geometry:v.geometry,index:g,segment:c};this.rBush_.insert(E(y.segment),y)}this.updateSegmentIndices_(a,u,v.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return i},s.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},s.prototype.updateSegmentIndices_=function(t,e,i,r){this.rBush_.forEachInExtent(t.getExtent(),function(n){n.geometry===t&&(i===void 0||n.depth===void 0||$e(n.depth,i))&&n.index>e&&(n.index+=r)})},s}(fe);function at(_,s){return _.index-s.index}function ye(_,s,t){var e=s.geometry;if(e.getType()===p.CIRCLE){var i=e;if(s.index===k){var r=V();r&&(i=i.clone().transform(r,t));var n=L(i.getCenter(),C(_)),o=Math.sqrt(n)-i.getRadius();return o*o}}var a=C(_);return N[0]=C(s.segment[0]),N[1]=C(s.segment[1]),ve(a,N)}function xe(_,s,t){var e=s.geometry;if(e.getType()===p.CIRCLE&&s.index===k){var i=e,r=V();return r&&(i=i.clone().transform(r,t)),W(i.getClosestPoint(C(_)))}var n=C(_);return N[0]=C(s.segment[0]),N[1]=C(s.segment[1]),W(de(n,N))}function ot(){var _=Oe();return function(s,t){return _[p.POINT]}}var st=nt,ut=globalThis&&globalThis.__extends||function(){var _=function(s,t){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},_(s,t)};return function(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");_(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();function Ee(_){if(_.feature)return _.feature;if(_.element)return _.element}var B=[],lt=function(_){ut(s,_);function s(t){var e=this,i=t||{},r=i;return r.handleDownEvent||(r.handleDownEvent=je),r.stopDown||(r.stopDown=ze),e=_.call(this,r)||this,e.source_=i.source?i.source:null,e.vertex_=i.vertex!==void 0?i.vertex:!0,e.edge_=i.edge!==void 0?i.edge:!0,e.features_=i.features?i.features:null,e.featuresListenerKeys_=[],e.featureChangeListenerKeys_={},e.indexedFeaturesExtents_={},e.pendingFeatures_={},e.pixelTolerance_=i.pixelTolerance!==void 0?i.pixelTolerance:10,e.rBush_=new ae,e.SEGMENT_WRITERS_={Point:e.writePointGeometry_.bind(e),LineString:e.writeLineStringGeometry_.bind(e),LinearRing:e.writeLineStringGeometry_.bind(e),Polygon:e.writePolygonGeometry_.bind(e),MultiPoint:e.writeMultiPointGeometry_.bind(e),MultiLineString:e.writeMultiLineStringGeometry_.bind(e),MultiPolygon:e.writeMultiPolygonGeometry_.bind(e),GeometryCollection:e.writeGeometryCollectionGeometry_.bind(e),Circle:e.writeCircleGeometry_.bind(e)},e}return s.prototype.addFeature=function(t,e){var i=e!==void 0?e:!0,r=m(t),n=t.getGeometry();if(n){var o=this.SEGMENT_WRITERS_[n.getType()];o&&(this.indexedFeaturesExtents_[r]=n.getExtent(Je()),o(t,n))}i&&(this.featureChangeListenerKeys_[r]=U(t,j.CHANGE,this.handleFeatureChange_,this))},s.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},s.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},s.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},s.prototype.handleEvent=function(t){var e=this.snapTo(t.pixel,t.coordinate,t.map);return e.snapped&&(t.coordinate=e.vertex.slice(0,2),t.pixel=e.vertexPixel),_.prototype.handleEvent.call(this,t)},s.prototype.handleFeatureAdd_=function(t){var e=Ee(t);this.addFeature(e)},s.prototype.handleFeatureRemove_=function(t){var e=Ee(t);this.removeFeature(e)},s.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var i=m(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)},s.prototype.handleUpEvent=function(t){var e=Qe(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},s.prototype.removeFeature=function(t,e){var i=e!==void 0?e:!0,r=m(t),n=this.indexedFeaturesExtents_[r];if(n){var o=this.rBush_,a=[];o.forEachInExtent(n,function(u){t===u.feature&&a.push(u)});for(var l=a.length-1;l>=0;--l)o.remove(a[l])}i&&(_e(this.featureChangeListenerKeys_[r]),delete this.featureChangeListenerKeys_[r])},s.prototype.setMap=function(t){var e=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();e&&(i.forEach(_e),i.length=0,r.forEach(this.forEachFeatureRemove_.bind(this))),_.prototype.setMap.call(this,t),t&&(this.features_?i.push(U(this.features_,D.ADD,this.handleFeatureAdd_,this),U(this.features_,D.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(U(this.source_,K.ADDFEATURE,this.handleFeatureAdd_,this),U(this.source_,K.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(this.forEachFeatureAdd_.bind(this)))},s.prototype.snapTo=function(t,e,i){var r=i.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),n=i.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_]),o=E([r,n]),a=this.rBush_.getInExtent(o);this.vertex_&&!this.edge_&&(a=a.filter(function(I){return I.feature.getGeometry().getType()!==p.CIRCLE}));var l=!1,u=null,h=null;if(a.length===0)return{snapped:l,vertex:u,vertexPixel:h};for(var g=i.getView().getProjection(),d=C(e),v,f=1/0,c=0;c<a.length;++c){var y=a[c];B[0]=C(y.segment[0]),B[1]=C(y.segment[1]);var F=ve(d,B);F<f&&(v=y,f=F)}var x=v.segment;if(this.vertex_&&!this.edge_){var w=i.getPixelFromCoordinate(x[0]),A=i.getPixelFromCoordinate(x[1]),P=L(t,w),S=L(t,A),b=Math.sqrt(Math.min(P,S));b<=this.pixelTolerance_&&(l=!0,u=P>S?x[1]:x[0],h=i.getPixelFromCoordinate(u))}else if(this.edge_){var R=v.feature.getGeometry().getType()===p.CIRCLE;if(R){var T=v.feature.getGeometry(),Y=V();Y&&(T=T.clone().transform(Y,g)),u=W(Ze(d,T))}else B[0]=C(x[0]),B[1]=C(x[1]),u=W(de(d,B));if(h=i.getPixelFromCoordinate(u),J(t,h)<=this.pixelTolerance_&&(l=!0,this.vertex_&&!R)){var w=i.getPixelFromCoordinate(x[0]),A=i.getPixelFromCoordinate(x[1]),P=L(h,w),S=L(h,A),b=Math.sqrt(Math.min(P,S));b<=this.pixelTolerance_&&(u=P>S?x[1]:x[0],h=i.getPixelFromCoordinate(u))}}return l&&(h=[Math.round(h[0]),Math.round(h[1])]),{snapped:l,vertex:u,vertexPixel:h}},s.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},s.prototype.writeCircleGeometry_=function(t,e){this.getMap().getView().getProjection();for(var i=e,r=he(i),n=r.getCoordinates()[0],o=0,a=n.length-1;o<a;++o){var l=n.slice(o,o+2),u={feature:t,segment:l};this.rBush_.insert(E(l),u)}},s.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r){var n=this.SEGMENT_WRITERS_[i[r].getType()];n&&n(t,i[r])}},s.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length-1;r<n;++r){var o=i.slice(r,r+2),a={feature:t,segment:o};this.rBush_.insert(E(o),a)}},s.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],a=0,l=o.length-1;a<l;++a){var u=o.slice(a,a+2),h={feature:t,segment:u};this.rBush_.insert(E(u),h)}},s.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r){var o=i[r],a={feature:t,segment:[o,o]};this.rBush_.insert(e.getExtent(),a)}},s.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],a=0,l=o.length;a<l;++a)for(var u=o[a],h=0,g=u.length-1;h<g;++h){var d=u.slice(h,h+2),v={feature:t,segment:d};this.rBush_.insert(E(d),v)}},s.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)},s.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],a=0,l=o.length-1;a<l;++a){var u=o.slice(a,a+2),h={feature:t,segment:u};this.rBush_.insert(E(u),h)}},s}(fe),ht=lt;const ft=_=>(Ie("data-v-98c36a3a"),_=_(),Ge(),_),dt=ft(()=>ie("div",{id:"map",class:"map__x"},null,-1)),vt=["value"],_t={setup(_){const s=Ce(),t=q("Polygon"),e=Fe([{value:"Point",label:"\u70B9"},{value:"LineString",label:"\u7EBF"},{value:"Polygon",label:"\u591A\u8FB9\u5F62"},{value:"Circle",label:"\u5706"},{value:"None",label:"\u65E0"}]),i=new Le({source:new be}),r=new se({wrapX:!1}),n=new oe({source:r,style:new Ne({fill:new ue({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Be({color:"#ffcc33",width:2}),image:new Ae({radius:7,fill:new ue({color:"#ffcc33"})})})}),o=new st({source:r,insertVertexCondition:()=>!1}),a=q(null);function l(){a.value=new et({target:"map",layers:[i,n],view:new tt({projection:"EPSG:4326",center:[115.543045,45.16871],zoom:10})}),a.value.addInteraction(o),g()}const u=q(null),h=q(null);function g(){u.value!==null&&a.value.removeInteraction(u.value),h.value!==null&&a.value.removeInteraction(h.value),t.value!=="None"&&(u.value=new it({source:r,type:t.value}),a.value.addInteraction(u.value),h.value=new ht({source:r}))}return me(()=>{s.commit("setComponentPath","src/views/OpenLayers/Basic/pages/SnapGraph/SnapGraph.vue"),l()}),(d,v)=>(X(),$(ne,null,[dt,Se(ie("select",{id:"type","onUpdate:modelValue":v[0]||(v[0]=f=>t.value=f),onChange:g},[(X(!0),$(ne,null,we(Pe(e),f=>(X(),$("option",{key:f.value,value:f.value},Me(f.label),9,vt))),128))],544),[[Te,t.value]])],64))}};var Tt=rt(_t,[["__scopeId","data-v-98c36a3a"]]);export{Tt as default};
