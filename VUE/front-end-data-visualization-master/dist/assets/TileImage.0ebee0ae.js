import{E as gt,T as d,a as Gt,e as ge,b as pe,l as de,c as pt,d as U,f as at,L as _e,g as dt,h as Ut,i as st,j as z,k as zt,t as ye,m as Te,n as me,o as lt,p as xe,q as Ee,r as Oe,C as Fe,s as Ce,u as Z,v as Re,w as we,x as Pe,y as Ie,z as _t,A as Zt,B as Le,D as ut,F as yt,G as je,H as Tt,I as Se,J as Me,K as Ae,N as Xe,O as Wt,P as kt,Q as De,R as Kt,S as mt,U as Ye,W as Nt,X as B,Y as xt,Z as Ge,_ as Et,$ as Ue,a0 as ze,a1 as Ze,a2 as We,a3 as ke,a4 as V,a5 as Ke,a6 as Ne,a7 as $e}from"./ol.bb58850a.js";var qe=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),be=function(n){qe(e,n);function e(t,i,r){var o=n.call(this)||this,a=r||{};return o.tileCoord=t,o.state=i,o.interimTile=null,o.key="",o.transition_=a.transition===void 0?250:a.transition,o.transitionStarts_={},o}return e.prototype.changed=function(){this.dispatchEvent(gt.CHANGE)},e.prototype.release=function(){},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==d.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(!!this.interimTile){var t=this.interimTile,i=this;do{if(t.getState()==d.LOADED){t.interimTile=null;break}else t.getState()==d.LOADING?i=t:t.getState()==d.IDLE?i.interimTile=t.interimTile:i=t;t=i.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){if(this.state!==d.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},e.prototype.load=function(){Gt()},e.prototype.getAlpha=function(t,i){if(!this.transition_)return 1;var r=this.transitionStarts_[t];if(!r)r=i,this.transitionStarts_[t]=r;else if(r===-1)return 1;var o=i-r+1e3/60;return o>=this.transition_?1:ge(o/this.transition_)},e.prototype.inTransition=function(t){return this.transition_?this.transitionStarts_[t]!==-1:!1},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(pe),$t=be,He=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Be=function(n){He(e,n);function e(t,i,r,o,a,s){var l=n.call(this,t,i,s)||this;return l.crossOrigin_=o,l.src_=r,l.key=r,l.image_=new Image,o!==null&&(l.image_.crossOrigin=o),l.unlisten_=null,l.tileLoadFunction_=a,l}return e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(t){this.image_=t,this.state=d.LOADED,this.unlistenImage_(),this.changed()},e.prototype.handleImageError_=function(){this.state=d.ERROR,this.unlistenImage_(),this.image_=Qe(),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=d.LOADED:this.state=d.EMPTY,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==d.ERROR&&(this.state=d.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==d.IDLE&&(this.state=d.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=de(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}($t);function Qe(){var n=pt(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}var Je=Be,Ve=function(){function n(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return n.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},n.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},n.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)},n.prototype.forEach=function(e){for(var t=this.oldest_;t;)e(t.value_,t.key_,this),t=t.newer},n.prototype.get=function(e,t){var i=this.entries_[e];return U(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_},n.prototype.remove=function(e){var t=this.entries_[e];return U(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_},n.prototype.getCount=function(){return this.count_},n.prototype.getKeys=function(){var e=new Array(this.count_),t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e},n.prototype.getValues=function(){var e=new Array(this.count_),t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e},n.prototype.peekLast=function(){return this.oldest_.value_},n.prototype.peekLastKey=function(){return this.oldest_.key_},n.prototype.peekFirstKey=function(){return this.newest_.key_},n.prototype.pop=function(){var e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_},n.prototype.replace=function(e,t){this.get(e),this.entries_[e].value_=t},n.prototype.set=function(e,t){U(!(e in this.entries_),16);var i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_},n.prototype.setSize=function(e){this.highWaterMark=e},n}(),ti=Ve;function qt(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function ht(n,e,t){return n+"/"+e+"/"+t}function bt(n){return ht(n[0],n[1],n[2])}function ei(n){return n.split("/").map(Number)}function ii(n){return(n[1]<<n[0])+n[2]}function ri(n,e){var t=n[0],i=n[1],r=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;var o=e.getFullTileRange(t);return o?o.containsXY(i,r):!0}var ni=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),oi=function(n){ni(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.expireCache=function(t){for(;this.canExpireCache();){var i=this.peekLast();if(i.getKey()in t)break;this.pop().release()}},e.prototype.pruneExceptNewestZ=function(){if(this.getCount()!==0){var t=this.peekFirstKey(),i=ei(t),r=i[0];this.forEach(function(o){o.tileCoord[0]!==r&&(this.remove(bt(o.tileCoord)),o.release())}.bind(this))}},e}(ti),Ht=oi,Bt=function(){function n(e,t,i,r){this.minX=e,this.maxX=t,this.minY=i,this.maxY=r}return n.prototype.contains=function(e){return this.containsXY(e[1],e[2])},n.prototype.containsTileRange=function(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY},n.prototype.containsXY=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY},n.prototype.equals=function(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY},n.prototype.extend=function(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)},n.prototype.getHeight=function(){return this.maxY-this.minY+1},n.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},n.prototype.getWidth=function(){return this.maxX-this.minX+1},n.prototype.intersects=function(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY},n}();function tt(n,e,t,i,r){return r!==void 0?(r.minX=n,r.maxX=e,r.minY=t,r.maxY=i,r):new Bt(n,e,t,i)}var Qt=Bt,ct={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},ai=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),si=function(n){ai(e,n);function e(t){var i=this,r=t||{},o=at({},r);return delete o.preload,delete o.useInterimTilesOnError,i=n.call(this,o)||this,i.on,i.once,i.un,i.setPreload(r.preload!==void 0?r.preload:0),i.setUseInterimTilesOnError(r.useInterimTilesOnError!==void 0?r.useInterimTilesOnError:!0),i}return e.prototype.getPreload=function(){return this.get(ct.PRELOAD)},e.prototype.setPreload=function(t){this.set(ct.PRELOAD,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(ct.USE_INTERIM_TILES_ON_ERROR)},e.prototype.setUseInterimTilesOnError=function(t){this.set(ct.USE_INTERIM_TILES_ON_ERROR,t)},e}(_e),li=si,ui=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Jt=function(n){ui(e,n);function e(t){var i=n.call(this,t)||this;return i.extentChanged=!0,i.renderedExtent_=null,i.renderedPixelRatio,i.renderedProjection=null,i.renderedRevision,i.renderedTiles=[],i.newTiles_=!1,i.tmpExtent=dt(),i.tmpTileRange_=new Qt(0,0,0,0),i}return e.prototype.isDrawableTile=function(t){var i=this.getLayer(),r=t.getState(),o=i.getUseInterimTilesOnError();return r==d.LOADED||r==d.EMPTY||r==d.ERROR&&!o},e.prototype.getTile=function(t,i,r,o){var a=o.pixelRatio,s=o.viewState.projection,l=this.getLayer(),u=l.getSource(),f=u.getTile(t,i,r,a,s);return f.getState()==d.ERROR&&(l.getUseInterimTilesOnError()?l.getPreload()>0&&(this.newTiles_=!0):f.setState(d.LOADED)),this.isDrawableTile(f)||(f=f.getInterimTile()),f},e.prototype.loadedTileCallback=function(t,i,r){return this.isDrawableTile(r)?n.prototype.loadedTileCallback.call(this,t,i,r):!1},e.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},e.prototype.renderFrame=function(t,i){var r=t.layerStatesArray[t.layerIndex],o=t.viewState,a=o.projection,s=o.resolution,l=o.center,u=o.rotation,f=t.pixelRatio,p=this.getLayer(),c=p.getSource(),y=c.getRevision(),h=c.getTileGridForProjection(a),x=h.getZForResolution(s,c.zDirection),m=h.getResolution(x),_=t.extent,O=r.extent&&Ut(r.extent);O&&(_=st(_,Ut(r.extent)));var g=c.getTilePixelRatio(f),v=Math.round(t.size[0]*g),T=Math.round(t.size[1]*g);if(u){var S=Math.round(Math.sqrt(v*v+T*T));v=S,T=S}var E=m*v/2/g,R=m*T/2/g,P=[l[0]-E,l[1]-R,l[0]+E,l[1]+R],I=h.getTileRangeForExtentAndZ(_,x),L={};L[x]={};var A=this.createLoadedTileFinder(c,a,L),X=this.tmpExtent,Y=this.tmpTileRange_;this.newTiles_=!1;for(var w=I.minX;w<=I.maxX;++w)for(var j=I.minY;j<=I.maxY;++j){var C=this.getTile(x,w,j,t);if(this.isDrawableTile(C)){var W=z(this);if(C.getState()==d.LOADED){L[x][C.tileCoord.toString()]=C;var N=C.inTransition(W);!this.newTiles_&&(N||this.renderedTiles.indexOf(C)===-1)&&(this.newTiles_=!0)}if(C.getAlpha(W,t.time)===1)continue}var Q=h.getTileCoordChildTileRange(C.tileCoord,Y,X),J=!1;Q&&(J=A(x+1,Q)),J||h.forEachTileCoordParentTileRange(C.tileCoord,A,Y,X)}var $=m/s;zt(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/g,1/g,u,-v/2,-T/2);var et=ye(this.pixelTransform);this.useContainer(i,et,r.opacity);var F=this.context,M=F.canvas;Te(this.inversePixelTransform,this.pixelTransform),zt(this.tempTransform,v/2,T/2,$,$,0,-v/2,-T/2),M.width!=v||M.height!=T?(M.width=v,M.height=T):this.containerReused||F.clearRect(0,0,v,T),O&&this.clipUnrotated(F,t,O),at(F,c.getContextOptions()),this.preRender(F,t),this.renderedTiles.length=0;var q=Object.keys(L).map(Number);q.sort(me);var k,D,G;r.opacity===1&&(!this.containerReused||c.getOpaque(t.viewState.projection))?q=q.reverse():(k=[],D=[]);for(var ft=q.length-1;ft>=0;--ft){var b=q[ft],Rt=c.getTilePixelSize(b,f,a),le=h.getResolution(b),wt=le/m,Pt=Rt[0]*wt*$,It=Rt[1]*wt*$,vt=h.getTileCoordForCoordAndZ(lt(P),b),Lt=h.getTileCoordExtent(vt),it=xe(this.tempTransform,[g*(Lt[0]-P[0])/m,g*(P[3]-Lt[3])/m]),ue=g*c.getGutterForProjection(a),jt=L[b];for(var he in jt){var C=jt[he],St=C.tileCoord,Mt=vt[1]-St[1],ce=Math.round(it[0]-(Mt-1)*Pt),At=vt[2]-St[2],fe=Math.round(it[1]-(At-1)*It),w=Math.round(it[0]-Mt*Pt),j=Math.round(it[1]-At*It),rt=ce-w,nt=fe-j,Xt=x===b,N=Xt&&C.getAlpha(z(this),t.time)!==1;if(!N)if(k){F.save(),G=[w,j,w+rt,j,w+rt,j+nt,w,j+nt];for(var ot=0,ve=k.length;ot<ve;++ot)if(x!==b&&b<D[ot]){var H=k[ot];F.beginPath(),F.moveTo(G[0],G[1]),F.lineTo(G[2],G[3]),F.lineTo(G[4],G[5]),F.lineTo(G[6],G[7]),F.moveTo(H[6],H[7]),F.lineTo(H[4],H[5]),F.lineTo(H[2],H[3]),F.lineTo(H[0],H[1]),F.clip()}k.push(G),D.push(b)}else F.clearRect(w,j,rt,nt);this.drawTileImage(C,t,w,j,rt,nt,ue,Xt),k&&!N?(F.restore(),this.renderedTiles.unshift(C)):this.renderedTiles.push(C),this.updateUsedTiles(t.usedTiles,c,C)}}this.renderedRevision=y,this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!Ee(this.renderedExtent_,P),this.renderedExtent_=P,this.renderedPixelRatio=f,this.renderedProjection=a,this.manageTilePyramid(t,c,h,f,a,_,x,p.getPreload()),this.scheduleExpireCache(t,c),this.postRender(F,t),r.extent&&F.restore(),et!==M.style.transform&&(M.style.transform=et);var Dt=Oe(r.opacity),Yt=this.container;return Dt!==Yt.style.opacity&&(Yt.style.opacity=Dt),this.container},e.prototype.drawTileImage=function(t,i,r,o,a,s,l,u){var f=this.getTileImage(t);if(!!f){var p=z(this),c=u?t.getAlpha(p,i.time):1,y=c!==this.context.globalAlpha;y&&(this.context.save(),this.context.globalAlpha=c),this.context.drawImage(f,l,l,f.width-2*l,f.height-2*l,r,o,a,s),y&&this.context.restore(),c!==1?i.animate=!0:u&&t.endTransition(p)}},e.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},e.prototype.getTileImage=function(t){return t.getImage()},e.prototype.scheduleExpireCache=function(t,i){if(i.canExpireCache()){var r=function(o,a,s){var l=z(o);l in s.usedTiles&&o.expireCache(s.viewState.projection,s.usedTiles[l])}.bind(null,i);t.postRenderFunctions.push(r)}},e.prototype.updateUsedTiles=function(t,i,r){var o=z(i);o in t||(t[o]={}),t[o][r.getKey()]=!0},e.prototype.manageTilePyramid=function(t,i,r,o,a,s,l,u,f){var p=z(i);p in t.wantedTiles||(t.wantedTiles[p]={});var c=t.wantedTiles[p],y=t.tileQueue,h=r.getMinZoom(),x=0,m,_,O,g,v,T;for(T=h;T<=l;++T)for(_=r.getTileRangeForExtentAndZ(s,T,_),O=r.getResolution(T),g=_.minX;g<=_.maxX;++g)for(v=_.minY;v<=_.maxY;++v)l-T<=u?(++x,m=i.getTile(T,g,v,o,a),m.getState()==d.IDLE&&(c[m.getKey()]=!0,y.isKeyQueued(m.getKey())||y.enqueue([m,p,r.getTileCoordCenter(m.tileCoord),O])),f!==void 0&&f(m)):i.useTile(T,g,v,a);i.updateCacheSize(x,a)},e}(Fe);Jt.prototype.getLayer;var hi=Jt,ci=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),fi=function(n){ci(e,n);function e(t){return n.call(this,t)||this}return e.prototype.createRenderer=function(){return new hi(this)},e}(li),Wi=fi,vi=.5,K=!0,gi=10,Vt=.25,pi=function(){function n(e,t,i,r,o,a){this.sourceProj_=e,this.targetProj_=t;var s={},l=Ce(this.targetProj_,this.sourceProj_);this.transformInv_=function(g){var v=g[0]+"/"+g[1];return s[v]||(s[v]=l(g)),s[v]},this.maxSourceExtent_=r,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Z(r)==Z(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Z(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Z(this.targetProj_.getExtent()):null;var u=lt(i),f=Re(i),p=we(i),c=Pe(i),y=this.transformInv_(u),h=this.transformInv_(f),x=this.transformInv_(p),m=this.transformInv_(c),_=gi+(a?Math.max(0,Math.ceil(Ie(_t(i)/(a*a*256*256)))):0);if(this.addQuad_(u,f,p,c,y,h,x,m,_),this.wrapsXInSource_){var O=1/0;this.triangles_.forEach(function(g,v,T){O=Math.min(O,g.source[0][0],g.source[1][0],g.source[2][0])}),this.triangles_.forEach(function(g){if(Math.max(g.source[0][0],g.source[1][0],g.source[2][0])-O>this.sourceWorldWidth_/2){var v=[[g.source[0][0],g.source[0][1]],[g.source[1][0],g.source[1][1]],[g.source[2][0],g.source[2][1]]];v[0][0]-O>this.sourceWorldWidth_/2&&(v[0][0]-=this.sourceWorldWidth_),v[1][0]-O>this.sourceWorldWidth_/2&&(v[1][0]-=this.sourceWorldWidth_),v[2][0]-O>this.sourceWorldWidth_/2&&(v[2][0]-=this.sourceWorldWidth_);var T=Math.min(v[0][0],v[1][0],v[2][0]),S=Math.max(v[0][0],v[1][0],v[2][0]);S-T<this.sourceWorldWidth_/2&&(g.source=v)}}.bind(this))}s={}}return n.prototype.addTriangle_=function(e,t,i,r,o,a){this.triangles_.push({source:[r,o,a],target:[e,t,i]})},n.prototype.addQuad_=function(e,t,i,r,o,a,s,l,u){var f=Zt([o,a,s,l]),p=this.sourceWorldWidth_?Z(f)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,y=this.sourceProj_.canWrapX()&&p>.5&&p<1,h=!1;if(u>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var x=Zt([e,t,i,r]),m=Z(x)/this.targetWorldWidth_;h=m>Vt||h}!y&&this.sourceProj_.isGlobal()&&p&&(h=p>Vt||h)}if(!(!h&&this.maxSourceExtent_&&isFinite(f[0])&&isFinite(f[1])&&isFinite(f[2])&&isFinite(f[3])&&!Le(f,this.maxSourceExtent_))){var _=0;if(!h&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(l[0])||!isFinite(l[1]))){if(u>0)h=!0;else if(_=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(s[0])||!isFinite(s[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(u>0){if(!h){var O=[(e[0]+i[0])/2,(e[1]+i[1])/2],g=this.transformInv_(O),v=void 0;if(y){var T=(ut(o[0],c)+ut(s[0],c))/2;v=T-ut(g[0],c)}else v=(o[0]+s[0])/2-g[0];var S=(o[1]+s[1])/2-g[1],E=v*v+S*S;h=E>this.errorThresholdSquared_}if(h){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){var R=[(t[0]+i[0])/2,(t[1]+i[1])/2],P=this.transformInv_(R),I=[(r[0]+e[0])/2,(r[1]+e[1])/2],L=this.transformInv_(I);this.addQuad_(e,t,R,I,o,a,P,L,u-1),this.addQuad_(I,R,i,r,L,P,s,l,u-1)}else{var A=[(e[0]+t[0])/2,(e[1]+t[1])/2],X=this.transformInv_(A),Y=[(i[0]+r[0])/2,(i[1]+r[1])/2],w=this.transformInv_(Y);this.addQuad_(e,A,Y,r,o,X,w,l,u-1),this.addQuad_(A,t,i,Y,X,a,s,w,u-1)}return}}if(y){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(_&11)==0&&this.addTriangle_(e,i,r,o,s,l),(_&14)==0&&this.addTriangle_(e,i,t,o,s,a),_&&((_&13)==0&&this.addTriangle_(t,r,e,a,l,o),(_&7)==0&&this.addTriangle_(t,r,i,a,l,s))}},n.prototype.calculateSourceExtent=function(){var e=dt();return this.triangles_.forEach(function(t,i,r){var o=t.source;yt(e,o[0]),yt(e,o[1]),yt(e,o[2])}),e},n.prototype.getTriangles=function(){return this.triangles_},n}(),di=pi,te={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},Ot;function ee(n,e,t,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,r)),n.restore()}function Ft(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function _i(){if(Ot===void 0){var n=document.createElement("canvas").getContext("2d");n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",ee(n,4,5,4,0),ee(n,4,5,0,5);var e=n.getImageData(0,0,3,3).data;Ot=Ft(e,0)||Ft(e,4)||Ft(e,8)}return Ot}function ie(n,e,t,i){var r=Xe(t,e,n),o=Wt(e,i,t),a=e.getMetersPerUnit();a!==void 0&&(o*=a);var s=n.getMetersPerUnit();s!==void 0&&(o/=s);var l=n.getExtent();if(!l||kt(l,r)){var u=Wt(n,o,r)/o;isFinite(u)&&u>0&&(o/=u)}return o}function yi(n,e,t,i){var r=Me(t),o=ie(n,e,r,i);return(!isFinite(o)||o<=0)&&Ae(t,function(a){return o=ie(n,e,a,i),isFinite(o)&&o>0}),o}function Ti(n,e,t,i,r,o,a,s,l,u,f,p){var c=pt(Math.round(t*n),Math.round(t*e));if(at(c,p),l.length===0)return c.canvas;c.scale(t,t);function y(v){return Math.round(v*t)/t}c.globalCompositeOperation="lighter";var h=dt();l.forEach(function(v,T,S){je(h,v.extent)});var x=Z(h),m=Tt(h),_=pt(Math.round(t*x/i),Math.round(t*m/i));at(_,p);var O=t/i;l.forEach(function(v,T,S){var E=v.extent[0]-h[0],R=-(v.extent[3]-h[3]),P=Z(v.extent),I=Tt(v.extent);v.image.width>0&&v.image.height>0&&_.drawImage(v.image,u,u,v.image.width-2*u,v.image.height-2*u,E*O,R*O,P*O,I*O)});var g=lt(a);return s.getTriangles().forEach(function(v,T,S){var E=v.source,R=v.target,P=E[0][0],I=E[0][1],L=E[1][0],A=E[1][1],X=E[2][0],Y=E[2][1],w=y((R[0][0]-g[0])/o),j=y(-(R[0][1]-g[1])/o),C=y((R[1][0]-g[0])/o),W=y(-(R[1][1]-g[1])/o),N=y((R[2][0]-g[0])/o),Q=y(-(R[2][1]-g[1])/o),J=P,$=I;P=0,I=0,L-=J,A-=$,X-=J,Y-=$;var et=[[L,A,0,0,C-w],[X,Y,0,0,N-w],[0,0,L,A,W-j],[0,0,X,Y,Q-j]],F=Se(et);if(!!F){if(c.save(),c.beginPath(),_i()||p===te){c.moveTo(C,W);for(var M=4,q=w-C,k=j-W,D=0;D<M;D++)c.lineTo(C+y((D+1)*q/M),W+y(D*k/(M-1))),D!=M-1&&c.lineTo(C+y((D+1)*q/M),W+y((D+1)*k/(M-1)));c.lineTo(N,Q)}else c.moveTo(C,W),c.lineTo(w,j),c.lineTo(N,Q);c.clip(),c.transform(F[0],F[2],F[1],F[3],w,j),c.translate(h[0]-J,h[3]-$),c.scale(i/t,-i/t),c.drawImage(_.canvas,0,0),c.restore()}}),f&&(c.save(),c.globalCompositeOperation="source-over",c.strokeStyle="black",c.lineWidth=1,s.getTriangles().forEach(function(v,T,S){var E=v.target,R=(E[0][0]-g[0])/o,P=-(E[0][1]-g[1])/o,I=(E[1][0]-g[0])/o,L=-(E[1][1]-g[1])/o,A=(E[2][0]-g[0])/o,X=-(E[2][1]-g[1])/o;c.beginPath(),c.moveTo(I,L),c.lineTo(R,P),c.lineTo(A,X),c.closePath(),c.stroke()}),c.restore()),c.canvas}var mi=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),xi=function(n){mi(e,n);function e(t,i,r,o,a,s,l,u,f,p,c,y){var h=n.call(this,a,d.IDLE)||this;h.renderEdges_=c!==void 0?c:!1,h.contextOptions_=y,h.pixelRatio_=l,h.gutter_=u,h.canvas_=null,h.sourceTileGrid_=i,h.targetTileGrid_=o,h.wrappedTileCoord_=s||a,h.sourceTiles_=[],h.sourcesListenerKeys_=null,h.sourceZ_=0;var x=o.getTileCoordExtent(h.wrappedTileCoord_),m=h.targetTileGrid_.getExtent(),_=h.sourceTileGrid_.getExtent(),O=m?st(x,m):x;if(_t(O)===0)return h.state=d.EMPTY,h;var g=t.getExtent();g&&(_?_=st(_,g):_=g);var v=o.getResolution(h.wrappedTileCoord_[0]),T=yi(t,r,O,v);if(!isFinite(T)||T<=0)return h.state=d.EMPTY,h;var S=p!==void 0?p:vi;if(h.triangulation_=new di(t,r,O,_,T*S,v),h.triangulation_.getTriangles().length===0)return h.state=d.EMPTY,h;h.sourceZ_=i.getZForResolution(T);var E=h.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(E[1]=mt(E[1],_[1],_[3]),E[3]=mt(E[3],_[1],_[3])):E=st(E,_)),!_t(E))h.state=d.EMPTY;else{for(var R=i.getTileRangeForExtentAndZ(E,h.sourceZ_),P=R.minX;P<=R.maxX;P++)for(var I=R.minY;I<=R.maxY;I++){var L=f(h.sourceZ_,P,I,l);L&&h.sourceTiles_.push(L)}h.sourceTiles_.length===0&&(h.state=d.EMPTY)}return h}return e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(f,p,c){f&&f.getState()==d.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(f.tileCoord),image:f.getImage()})}.bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=d.ERROR;else{var i=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(i),o=typeof r=="number"?r:r[0],a=typeof r=="number"?r:r[1],s=this.targetTileGrid_.getResolution(i),l=this.sourceTileGrid_.getResolution(this.sourceZ_),u=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ti(o,a,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),s,u,this.triangulation_,t,this.gutter_,this.renderEdges_,this.contextOptions_),this.state=d.LOADED}this.changed()},e.prototype.load=function(){if(this.state==d.IDLE){this.state=d.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(i,r,o){var a=i.getState();if(a==d.IDLE||a==d.LOADING){t++;var s=De(i,gt.CHANGE,function(l){var u=i.getState();(u==d.LOADED||u==d.ERROR||u==d.EMPTY)&&(Kt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}.bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(i,r,o){var a=i.getState();a==d.IDLE&&i.load()})}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(Kt),this.sourcesListenerKeys_=null},e}($t),Ei=xi,Ct={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Oi=[0,0,0],Fi=function(){function n(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,U(Ye(this.resolutions_,function(a,s){return s-a},!0),17);var t;if(!e.origins){for(var i=0,r=this.resolutions_.length-1;i<r;++i)if(!t)t=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,U(this.origins_.length==this.resolutions_.length,20));var o=e.extent;o!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=lt(o)),U(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,U(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Nt,U(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=o!==void 0?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(a,s){var l=new Qt(Math.min(0,a[0]),Math.max(a[0]-1,-1),Math.min(0,a[1]),Math.max(a[1]-1,-1));if(o){var u=this.getTileRangeForExtentAndZ(o,s);l.minX=Math.max(u.minX,l.minX),l.maxX=Math.min(u.maxX,l.maxX),l.minY=Math.max(u.minY,l.minY),l.maxY=Math.min(u.maxY,l.maxY)}return l},this):o&&this.calculateTileRanges_(o)}return n.prototype.forEachTileCoord=function(e,t,i){for(var r=this.getTileRangeForExtentAndZ(e,t),o=r.minX,a=r.maxX;o<=a;++o)for(var s=r.minY,l=r.maxY;s<=l;++s)i([t,o,s])},n.prototype.forEachTileCoordParentTileRange=function(e,t,i,r){var o,a,s,l=null,u=e[0]-1;for(this.zoomFactor_===2?(a=e[1],s=e[2]):l=this.getTileCoordExtent(e,r);u>=this.minZoom;){if(this.zoomFactor_===2?(a=Math.floor(a/2),s=Math.floor(s/2),o=tt(a,a,s,s,i)):o=this.getTileRangeForExtentAndZ(l,u,i),t(u,o))return!0;--u}return!1},n.prototype.getExtent=function(){return this.extent_},n.prototype.getMaxZoom=function(){return this.maxZoom},n.prototype.getMinZoom=function(){return this.minZoom},n.prototype.getOrigin=function(e){return this.origin_?this.origin_:this.origins_[e]},n.prototype.getResolution=function(e){return this.resolutions_[e]},n.prototype.getResolutions=function(){return this.resolutions_},n.prototype.getTileCoordChildTileRange=function(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){var r=e[1]*2,o=e[2]*2;return tt(r,r+1,o,o+1,t)}var a=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e[0]+1,t)}return null},n.prototype.getTileRangeForTileCoordAndZ=function(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;var r=e[0],o=e[1],a=e[2];if(t===r)return tt(o,a,o,a,i);if(this.zoomFactor_){var s=Math.pow(this.zoomFactor_,t-r),l=Math.floor(o*s),u=Math.floor(a*s);if(t<r)return tt(l,l,u,u,i);var f=Math.floor(s*(o+1))-1,p=Math.floor(s*(a+1))-1;return tt(l,f,u,p,i)}var c=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(c,t,i)},n.prototype.getTileRangeExtent=function(e,t,i){var r=this.getOrigin(e),o=this.getResolution(e),a=B(this.getTileSize(e),this.tmpSize_),s=r[0]+t.minX*a[0]*o,l=r[0]+(t.maxX+1)*a[0]*o,u=r[1]+t.minY*a[1]*o,f=r[1]+(t.maxY+1)*a[1]*o;return xt(s,u,l,f,i)},n.prototype.getTileRangeForExtentAndZ=function(e,t,i){var r=Oi;this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,r);var o=r[1],a=r[2];return this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,r),tt(o,r[1],a,r[2],i)},n.prototype.getTileCoordCenter=function(e){var t=this.getOrigin(e[0]),i=this.getResolution(e[0]),r=B(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*i,t[1]-(e[2]+.5)*r[1]*i]},n.prototype.getTileCoordExtent=function(e,t){var i=this.getOrigin(e[0]),r=this.getResolution(e[0]),o=B(this.getTileSize(e[0]),this.tmpSize_),a=i[0]+e[1]*o[0]*r,s=i[1]-(e[2]+1)*o[1]*r,l=a+o[0]*r,u=s+o[1]*r;return xt(a,s,l,u,t)},n.prototype.getTileCoordForCoordAndResolution=function(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)},n.prototype.getTileCoordForXYAndResolution_=function(e,t,i,r,o){var a=this.getZForResolution(i),s=i/this.getResolution(a),l=this.getOrigin(a),u=B(this.getTileSize(a),this.tmpSize_),f=r?.5:0,p=r?.5:0,c=Math.floor((e-l[0])/i+f),y=Math.floor((l[1]-t)/i+p),h=s*c/u[0],x=s*y/u[1];return r?(h=Math.ceil(h)-1,x=Math.ceil(x)-1):(h=Math.floor(h),x=Math.floor(x)),qt(a,h,x,o)},n.prototype.getTileCoordForXYAndZ_=function(e,t,i,r,o){var a=this.getOrigin(i),s=this.getResolution(i),l=B(this.getTileSize(i),this.tmpSize_),u=r?.5:0,f=r?.5:0,p=Math.floor((e-a[0])/s+u),c=Math.floor((a[1]-t)/s+f),y=p/l[0],h=c/l[1];return r?(y=Math.ceil(y)-1,h=Math.ceil(h)-1):(y=Math.floor(y),h=Math.floor(h)),qt(i,y,h,o)},n.prototype.getTileCoordForCoordAndZ=function(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)},n.prototype.getTileCoordResolution=function(e){return this.resolutions_[e[0]]},n.prototype.getTileSize=function(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]},n.prototype.getFullTileRange=function(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null},n.prototype.getZForResolution=function(e,t){var i=Ge(this.resolutions_,e,t||0);return mt(i,this.minZoom,this.maxZoom)},n.prototype.calculateTileRanges_=function(e){for(var t=this.resolutions_.length,i=new Array(t),r=this.minZoom;r<t;++r)i[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=i},n}(),re=Fi;function ne(n){var e=n.getDefaultTileGrid();return e||(e=wi(n),n.setDefaultTileGrid(e)),e}function Ci(n,e,t){var i=e[0],r=n.getTileCoordCenter(e),o=ae(t);if(kt(o,r))return e;var a=Z(o),s=Math.ceil((o[0]-r[0])/a);return r[0]+=a*s,n.getTileCoordForCoordAndZ(r,i)}function Ri(n,e,t,i){var r=i!==void 0?i:ke.TOP_LEFT,o=oe(n,e,t);return new re({extent:n,origin:Ze(n,r),resolutions:o,tileSize:t})}function ki(n){var e=n||{},t=e.extent||Et("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:oe(t,e.maxZoom,e.tileSize,e.maxResolution)};return new re(i)}function oe(n,e,t,i){for(var r=e!==void 0?e:We,o=Tt(n),a=Z(n),s=B(t!==void 0?t:Nt),l=i>0?i:Math.max(a/s[0],o/s[1]),u=r+1,f=new Array(u),p=0;p<u;++p)f[p]=l/Math.pow(2,p);return f}function wi(n,e,t,i){var r=ae(n);return Ri(r,e,t,i)}function ae(n){n=Et(n);var e=n.getExtent();if(!e){var t=180*Ue[ze.DEGREES]/n.getMetersPerUnit();e=xt(-t,-t,t,t)}return e}var se=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Pi=function(n){se(e,n);function e(t){var i=n.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX})||this;i.on,i.once,i.un,i.opaque_=t.opaque!==void 0?t.opaque:!1,i.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,i.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;var r=[256,256],o=t.tileGrid;return o&&B(o.getTileSize(o.getMinZoom()),r),i.tileCache=new Ht(t.cacheSize||0),i.tmpSize=[0,0],i.key_=t.key||"",i.tileOptions={transition:t.transition},i.zDirection=t.zDirection?t.zDirection:0,i}return e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,i){var r=this.getTileCacheForProjection(t);r&&r.expireCache(i)},e.prototype.forEachLoadedTile=function(t,i,r,o){var a=this.getTileCacheForProjection(t);if(!a)return!1;for(var s=!0,l,u,f,p=r.minX;p<=r.maxX;++p)for(var c=r.minY;c<=r.maxY;++c)u=ht(i,p,c),f=!1,a.containsKey(u)&&(l=a.get(u),f=l.getState()===d.LOADED,f&&(f=o(l)!==!1)),f||(s=!1);return s},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},e.prototype.getTile=function(t,i,r,o,a){return Gt()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:ne(t)},e.prototype.getTileCacheForProjection=function(t){return U(V(this.getProjection(),t),68),this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,i,r){var o=this.getTileGridForProjection(r),a=this.getTilePixelRatio(i),s=B(o.getTileSize(t),this.tmpSize);return a==1?s:Ke(s,a,this.tmpSize)},e.prototype.getTileCoordForTileUrlFunction=function(t,i){var r=i!==void 0?i:this.getProjection(),o=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=Ci(o,t,r)),ri(t,o)?t:null},e.prototype.clear=function(){this.tileCache.clear()},e.prototype.refresh=function(){this.clear(),n.prototype.refresh.call(this)},e.prototype.updateCacheSize=function(t,i){var r=this.getTileCacheForProjection(i);t>r.highWaterMark&&(r.highWaterMark=t)},e.prototype.useTile=function(t,i,r,o){},e}(Ne),Ii=function(n){se(e,n);function e(t,i){var r=n.call(this,t)||this;return r.tile=i,r}return e}($e),Li=Pi;function ji(n,e){var t=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,o=/\{-y\}/g;return function(a,s,l){if(a)return n.replace(t,a[0].toString()).replace(i,a[1].toString()).replace(r,a[2].toString()).replace(o,function(){var u=a[0],f=e.getFullTileRange(u);U(f,55);var p=f.getHeight()-a[2]-1;return p.toString()})}}function Si(n,e){for(var t=n.length,i=new Array(t),r=0;r<t;++r)i[r]=ji(n[r],e);return Mi(i)}function Mi(n){return n.length===1?n[0]:function(e,t,i){if(e){var r=ii(e),o=ut(r,n.length);return n[o](e,t,i)}else return}}function Ai(n){var e=[],t=/\{([a-z])-([a-z])\}/.exec(n);if(t){var i=t[1].charCodeAt(0),r=t[2].charCodeAt(0),o=void 0;for(o=i;o<=r;++o)e.push(n.replace(t[0],String.fromCharCode(o)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){for(var a=parseInt(t[2],10),s=parseInt(t[1],10);s<=a;s++)e.push(n.replace(t[0],s.toString()));return e}return e.push(n),e}var Xi=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Di=function(n){Xi(e,n);function e(t){var i=n.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return i.generateTileUrlFunction_=i.tileUrlFunction===e.prototype.tileUrlFunction,i.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(i.tileUrlFunction=t.tileUrlFunction),i.urls=null,t.urls?i.setUrls(t.urls):t.url&&i.setUrl(t.url),i.tileLoadingKeys_={},i}return e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var i=t.target,r=z(i),o=i.getState(),a;o==d.LOADING?(this.tileLoadingKeys_[r]=!0,a=Ct.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],a=o==d.ERROR?Ct.TILELOADERROR:o==d.LOADED?Ct.TILELOADEND:void 0),a!=null&&this.dispatchEvent(new Ii(a,i))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,i){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof i!="undefined"?this.setKey(i):this.changed()},e.prototype.setUrl=function(t){var i=Ai(t);this.urls=i,this.setUrls(i)},e.prototype.setUrls=function(t){this.urls=t;var i=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Si(t,this.tileGrid),i):this.setKey(i)},e.prototype.tileUrlFunction=function(t,i,r){},e.prototype.useTile=function(t,i,r){var o=ht(t,i,r);this.tileCache.containsKey(o)&&this.tileCache.get(o)},e}(Li),Yi=Di,Gi=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ui=function(n){Gi(e,n);function e(t){var i=n.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:zi,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return i.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,i.tileClass=t.tileClass!==void 0?t.tileClass:Je,i.tileCacheForProjection={},i.tileGridForProjection={},i.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,i.contextOptions_=t.imageSmoothing===!1?te:void 0,i.renderReprojectionEdges_=!1,i}return e.prototype.canExpireCache=function(){if(!K)return n.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},e.prototype.expireCache=function(t,i){if(!K){n.prototype.expireCache.call(this,t,i);return}var r=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==r?i:{});for(var o in this.tileCacheForProjection){var a=this.tileCacheForProjection[o];a.expireCache(a==r?i:{})}},e.prototype.getContextOptions=function(){return this.contextOptions_},e.prototype.getGutterForProjection=function(t){return K&&this.getProjection()&&t&&!V(this.getProjection(),t)?0:this.getGutter()},e.prototype.getGutter=function(){return 0},e.prototype.getKey=function(){return n.prototype.getKey.call(this)+(this.contextOptions_?`
`+JSON.stringify(this.contextOptions_):"")},e.prototype.getOpaque=function(t){return K&&this.getProjection()&&t&&!V(this.getProjection(),t)?!1:n.prototype.getOpaque.call(this,t)},e.prototype.getTileGridForProjection=function(t){if(!K)return n.prototype.getTileGridForProjection.call(this,t);var i=this.getProjection();if(this.tileGrid&&(!i||V(i,t)))return this.tileGrid;var r=z(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=ne(t)),this.tileGridForProjection[r]},e.prototype.getTileCacheForProjection=function(t){if(!K)return n.prototype.getTileCacheForProjection.call(this,t);var i=this.getProjection();if(!i||V(i,t))return this.tileCache;var r=z(t);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new Ht(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},e.prototype.createTile_=function(t,i,r,o,a,s){var l=[t,i,r],u=this.getTileCoordForTileUrlFunction(l,a),f=u?this.tileUrlFunction(u,o,a):void 0,p=new this.tileClass(l,f!==void 0?d.IDLE:d.EMPTY,f!==void 0?f:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return p.key=s,p.addEventListener(gt.CHANGE,this.handleTileChange.bind(this)),p},e.prototype.getTile=function(t,i,r,o,a){var s=this.getProjection();if(!K||!s||!a||V(s,a))return this.getTileInternal(t,i,r,o,s||a);var l=this.getTileCacheForProjection(a),u=[t,i,r],f=void 0,p=bt(u);l.containsKey(p)&&(f=l.get(p));var c=this.getKey();if(f&&f.key==c)return f;var y=this.getTileGridForProjection(s),h=this.getTileGridForProjection(a),x=this.getTileCoordForTileUrlFunction(u,a),m=new Ei(s,y,a,h,u,x,this.getTilePixelRatio(o),this.getGutter(),function(_,O,g,v){return this.getTileInternal(_,O,g,v,s)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.contextOptions_);return m.key=c,f?(m.interimTile=f,m.refreshInterimChain(),l.replace(p,m)):l.set(p,m),m},e.prototype.getTileInternal=function(t,i,r,o,a){var s=null,l=ht(t,i,r),u=this.getKey();if(!this.tileCache.containsKey(l))s=this.createTile_(t,i,r,o,a,u),this.tileCache.set(l,s);else if(s=this.tileCache.get(l),s.key!=u){var f=s;s=this.createTile_(t,i,r,o,a,u),f.getState()==d.IDLE?s.interimTile=f.interimTile:s.interimTile=f,s.refreshInterimChain(),this.tileCache.replace(l,s)}return s},e.prototype.setRenderReprojectionEdges=function(t){if(!(!K||this.renderReprojectionEdges_==t)){this.renderReprojectionEdges_=t;for(var i in this.tileCacheForProjection)this.tileCacheForProjection[i].clear();this.changed()}},e.prototype.setTileGridForProjection=function(t,i){if(K){var r=Et(t);if(r){var o=z(r);o in this.tileGridForProjection||(this.tileGridForProjection[o]=i)}}},e}(Yi);function zi(n,e){n.getImage().src=e}var Ki=Ui;export{Wi as T,Ki as a,Mi as b,ki as c,qt as d,ae as e,Si as f};
