var PKCS5PKEY=function(){var c=function(n,p,o){return i(CryptoJS.AES,n,p,o)};var d=function(n,p,o){return i(CryptoJS.TripleDES,n,p,o)};var i=function(q,v,s,o){var p=CryptoJS.enc.Hex.parse(v);var u=CryptoJS.enc.Hex.parse(s);var n=CryptoJS.enc.Hex.parse(o);var r={};r.key=u;r.iv=n;r.ciphertext=p;var t=q.decrypt(r,u,{iv:n});return CryptoJS.enc.Hex.stringify(t)};var j=function(n,p,o){return e(CryptoJS.AES,n,p,o)};var m=function(n,p,o){return e(CryptoJS.TripleDES,n,p,o)};var e=function(s,x,v,p){var r=CryptoJS.enc.Hex.parse(x);var w=CryptoJS.enc.Hex.parse(v);var o=CryptoJS.enc.Hex.parse(p);var n={};var u=s.encrypt(r,w,{iv:o});var q=CryptoJS.enc.Hex.parse(u.toString());var t=CryptoJS.enc.Base64.stringify(q);return t};var g={"AES-256-CBC":{proc:c,eproc:j,keylen:32,ivlen:16},"AES-192-CBC":{proc:c,eproc:j,keylen:24,ivlen:16},"AES-128-CBC":{proc:c,eproc:j,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:d,eproc:m,keylen:24,ivlen:8}};var b=function(n){return g[n]["proc"]};var k=function(n){var p=CryptoJS.lib.WordArray.random(n);var o=CryptoJS.enc.Hex.stringify(p);return o};var l=function(t){var u={};var o=t.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));if(o){u.cipher=o[1];u.ivsalt=o[2]}var n=t.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));if(n){u.type=n[1]}var r=-1;var v=0;if(t.indexOf("\r\n\r\n")!=-1){r=t.indexOf("\r\n\r\n");v=2}if(t.indexOf("\n\n")!=-1){r=t.indexOf("\n\n");v=1}var q=t.indexOf("-----END");if(r!=-1&&q!=-1){var p=t.substring(r+v*2,q-v);p=p.replace(/\s+/g,"");u.data=p}return u};var h=function(o,w,n){var t=n.substring(0,16);var r=CryptoJS.enc.Hex.parse(t);var p=CryptoJS.enc.Utf8.parse(w);var s=g[o]["keylen"]+g[o]["ivlen"];var v="";var u=null;for(;;){var q=CryptoJS.algo.MD5.create();if(u!=null){q.update(u)}q.update(p);q.update(r);u=q.finalize();v=v+CryptoJS.enc.Hex.stringify(u);if(v.length>=s*2){break}}var x={};x.keyhex=v.substr(0,g[o]["keylen"]*2);x.ivhex=v.substr(g[o]["keylen"]*2,g[o]["ivlen"]*2);return x};var a=function(n,t,p,u){var q=CryptoJS.enc.Base64.parse(n);var o=CryptoJS.enc.Hex.stringify(q);var s=g[t]["proc"];var r=s(o,p,u);return r};var f=function(n,q,o,s){var p=g[q]["eproc"];var r=p(n,o,s);return r};return{version:"1.0.5",getHexFromPEM:function(n,o){return pemtohex(n,o)},getDecryptedKeyHexByKeyIV:function(o,r,q,p){var n=b(r);return n(o,q,p)},parsePKCS5PEM:function(n){return l(n)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(o,n,p){return h(o,n,p)},decryptKeyB64:function(n,p,o,q){return a(n,p,o,q)},getDecryptedKeyHex:function(w,v){var o=l(w);var r=o.type;var p=o.cipher;var n=o.ivsalt;var q=o.data;var u=h(p,v,n);var t=u.keyhex;var s=a(q,p,t,n);return s},getRSAKeyFromEncryptedPKCS5PEM:function(p,o){var q=this.getDecryptedKeyHex(p,o);var n=new RSAKey();n.readPrivateKeyFromASN1HexString(q);return n},getEncryptedPKCS5PEMFromPrvKeyHex:function(q,x,r,p){if(typeof r=="undefined"||r==null){r="AES-256-CBC"}if(typeof g[r]=="undefined"){throw"PKCS5PKEY unsupported algorithm: "+r}if(typeof p=="undefined"||p==null){var t=g[r]["ivlen"];var s=k(t);p=s.toUpperCase()}var w=h(r,x,p);var v=w.keyhex;var u=f(q,r,v,p);var o=u.replace(/(.{64})/g,"$1\r\n");var n="-----BEGIN RSA PRIVATE KEY-----\r\n";n+="Proc-Type: 4,ENCRYPTED\r\n";n+="DEK-Info: "+r+","+p+"\r\n";n+="\r\n";n+=o;n+="\r\n-----END RSA PRIVATE KEY-----\r\n";return n},getEncryptedPKCS5PEMFromRSAKey:function(C,D,o,s){var A=new KJUR.asn1.DERInteger({"int":0});var v=new KJUR.asn1.DERInteger({bigint:C.n});var z=new KJUR.asn1.DERInteger({"int":C.e});var B=new KJUR.asn1.DERInteger({bigint:C.d});var t=new KJUR.asn1.DERInteger({bigint:C.p});var r=new KJUR.asn1.DERInteger({bigint:C.q});var y=new KJUR.asn1.DERInteger({bigint:C.dmp1});var u=new KJUR.asn1.DERInteger({bigint:C.dmq1});var x=new KJUR.asn1.DERInteger({bigint:C.coeff});var E=new KJUR.asn1.DERSequence({array:[A,v,z,B,t,r,y,u,x]});var w=E.getEncodedHex();return this.getEncryptedPKCS5PEMFromPrvKeyHex(w,D,o,s)},newEncryptedPKCS5PEM:function(n,o,r,s){if(typeof o=="undefined"||o==null){o=1024}if(typeof r=="undefined"||r==null){r="10001"}var p=new RSAKey();p.generate(o,r);var q=null;if(typeof s=="undefined"||s==null){q=this.getEncryptedPKCS5PEMFromRSAKey(pkey,n)}else{q=this.getEncryptedPKCS5PEMFromRSAKey(pkey,n,s)}return q},getRSAKeyFromPlainPKCS8PEM:function(p){if(p.match(/ENCRYPTED/)){throw"pem shall be not ENCRYPTED"}var o=pemtohex(p,"PRIVATE KEY");var n=this.getRSAKeyFromPlainPKCS8Hex(o);return n},getRSAKeyFromPlainPKCS8Hex:function(o){var n=new RSAKey();n.readPKCS8PrvKeyHex(o);return n},parseHexOfEncryptedPKCS8:function(w){var z=ASN1HEX;var x=z.getChildIdx;var u=z.getV;var r={};var p=x(w,0);if(p.length!=2){throw"malformed format: SEQUENCE(0).items != 2: "+p.length}r.ciphertext=u(w,p[1]);var y=x(w,p[0]);if(y.length!=2){throw"malformed format: SEQUENCE(0.0).items != 2: "+y.length}if(u(w,y[0])!="2a864886f70d01050d"){throw"this only supports pkcs5PBES2"}var n=x(w,y[1]);if(y.length!=2){throw"malformed format: SEQUENCE(0.0.1).items != 2: "+n.length}var o=x(w,n[1]);if(o.length!=2){throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+o.length}if(u(w,o[0])!="2a864886f70d0307"){throw"this only supports TripleDES"}r.encryptionSchemeAlg="TripleDES";r.encryptionSchemeIV=u(w,o[1]);var q=x(w,n[0]);if(q.length!=2){throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+q.length}if(u(w,q[0])!="2a864886f70d01050c"){throw"this only supports pkcs5PBKDF2"}var v=x(w,q[1]);if(v.length<2){throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+v.length}r.pbkdf2Salt=u(w,v[0]);var s=u(w,v[1]);try{r.pbkdf2Iter=parseInt(s,16)}catch(t){throw"malformed format pbkdf2Iter: "+s}return r},getPBKDF2KeyHexFromParam:function(s,n){var r=CryptoJS.enc.Hex.parse(s.pbkdf2Salt);var o=s.pbkdf2Iter;var q=CryptoJS.PBKDF2(n,r,{keySize:192/32,iterations:o});var p=CryptoJS.enc.Hex.stringify(q);return p},getPlainPKCS8HexFromEncryptedPKCS8PEM:function(v,w){var p=pemtohex(v,"ENCRYPTED PRIVATE KEY");var n=this.parseHexOfEncryptedPKCS8(p);var s=PKCS5PKEY.getPBKDF2KeyHexFromParam(n,w);var t={};t.ciphertext=CryptoJS.enc.Hex.parse(n.ciphertext);var r=CryptoJS.enc.Hex.parse(s);var q=CryptoJS.enc.Hex.parse(n.encryptionSchemeIV);var u=CryptoJS.TripleDES.decrypt(t,r,{iv:q});var o=CryptoJS.enc.Hex.stringify(u);return o},getRSAKeyFromEncryptedPKCS8PEM:function(q,p){var o=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(q,p);var n=this.getRSAKeyFromPlainPKCS8Hex(o);return n},getKeyFromEncryptedPKCS8PEM:function(q,o){var n=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(q,o);var p=this.getKeyFromPlainPrivatePKCS8Hex(n);return p},parsePlainPrivatePKCS8Hex:function(q){var t=ASN1HEX;var s=t.getChildIdx;var r=t.getV;var o={};o.algparam=null;if(q.substr(0,2)!="30"){throw"malformed plain PKCS8 private key(code:001)"}var p=s(q,0);if(p.length!=3){throw"malformed plain PKCS8 private key(code:002)"}if(q.substr(p[1],2)!="30"){throw"malformed PKCS8 private key(code:003)"}var n=s(q,p[1]);if(n.length!=2){throw"malformed PKCS8 private key(code:004)"}if(q.substr(n[0],2)!="06"){throw"malformed PKCS8 private key(code:005)"}o.algoid=r(q,n[0]);if(q.substr(n[1],2)=="06"){o.algparam=r(q,n[1])}if(q.substr(p[2],2)!="04"){throw"malformed PKCS8 private key(code:006)"}o.keyidx=t.getVidx(q,p[2]);return o},getKeyFromPlainPrivatePKCS8PEM:function(o){var n=pemtohex(o,"PRIVATE KEY");var p=this.getKeyFromPlainPrivatePKCS8Hex(n);return p},getKeyFromPlainPrivatePKCS8Hex:function(n){var o=this.parsePlainPrivatePKCS8Hex(n);var p;if(o.algoid=="2a864886f70d010101"){p=new RSAKey()}else{if(o.algoid=="2a8648ce380401"){p=new KJUR.crypto.DSA()}else{if(o.algoid=="2a8648ce3d0201"){p=new KJUR.crypto.ECDSA()}else{throw"unsupported private key algorithm"}}}p.readPKCS8PrvKeyHex(n);return p},getRSAKeyFromPublicPKCS8PEM:function(o){var p=pemtohex(o,"PUBLIC KEY");var n=this.getRSAKeyFromPublicPKCS8Hex(p);return n},getKeyFromPublicPKCS8PEM:function(o){var p=pemtohex(o,"PUBLIC KEY");var n=this.getKeyFromPublicPKCS8Hex(p);return n},getKeyFromPublicPKCS8Hex:function(o){var n;var p=ASN1HEX.getVbyList(o,0,[0,0],"06");if(p==="2a864886f70d010101"){n=new RSAKey()}else{if(p==="2a8648ce380401"){n=new KJUR.crypto.DSA()}else{if(p==="2a8648ce3d0201"){n=new KJUR.crypto.ECDSA()}else{throw"unsupported PKCS#8 public key hex"}}}n.readPKCS8PubKeyHex(o);return n},parsePublicRawRSAKeyHex:function(p){var s=ASN1HEX;var r=s.getChildIdx;var q=s.getV;var n={};if(p.substr(0,2)!="30"){throw"malformed RSA key(code:001)"}var o=r(p,0);if(o.length!=2){throw"malformed RSA key(code:002)"}if(p.substr(o[0],2)!="02"){throw"malformed RSA key(code:003)"}n.n=q(p,o[0]);if(p.substr(o[1],2)!="02"){throw"malformed RSA key(code:004)"}n.e=q(p,o[1]);return n},parsePrivateRawRSAKeyHexAtObj:function(o,t){var s=ASN1HEX;var r=s.getChildIdx;var p=s.getV;var q=s.getIdxbyList(o,0,[2,0]);var n=r(o,q);if(n.length!==9){throw"malformed PKCS#8 plain RSA private key"}t.key={};t.key.n=p(o,n[1]);t.key.e=p(o,n[2]);t.key.d=p(o,n[3]);t.key.p=p(o,n[4]);t.key.q=p(o,n[5]);t.key.dp=p(o,n[6]);t.key.dq=p(o,n[7]);t.key.co=p(o,n[8])},parsePrivateRawECKeyHexAtObj:function(n,q){var o=q.keyidx;var p=new KJUR.crypto.ECDSA();p.readPKCS8PrvKeyHex(n);q.key=p.prvKeyHex;q.pubkey=p.pubKeyHex},parsePublicPKCS8Hex:function(r){var t=ASN1HEX;var s=t.getChildIdx;var q=t.getV;var o={};o.algparam=null;var p=s(r,0);if(p.length!=2){throw"outer DERSequence shall have 2 elements: "+p.length}var u=p[0];if(r.substr(u,2)!="30"){throw"malformed PKCS8 public key(code:001)"}var n=s(r,u);if(n.length!=2){throw"malformed PKCS8 public key(code:002)"}if(r.substr(n[0],2)!="06"){throw"malformed PKCS8 public key(code:003)"}o.algoid=q(r,n[0]);if(r.substr(n[1],2)=="06"){o.algparam=q(r,n[1])}else{if(r.substr(n[1],2)=="30"){o.algparam={};o.algparam.p=t.getVbyList(r,n[1],[0],"02");o.algparam.q=t.getVbyList(r,n[1],[1],"02");o.algparam.g=t.getVbyList(r,n[1],[2],"02")}}if(r.substr(p[1],2)!="03"){throw"malformed PKCS8 public key(code:004)"}o.key=q(r,p[1]).substr(2);return o},getRSAKeyFromPublicPKCS8Hex:function(n){var o=new RSAKey();o.readPKCS8PubKeyHex(n);return o},}}();